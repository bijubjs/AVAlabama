<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bijesh Mishra, Ph.D.">

<title>AV Profit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="AV Profit_files/libs/clipboard/clipboard.min.js"></script>
<script src="AV Profit_files/libs/quarto-html/quarto.js"></script>
<script src="AV Profit_files/libs/quarto-html/popper.min.js"></script>
<script src="AV Profit_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AV Profit_files/libs/quarto-html/anchor.min.js"></script>
<link href="AV Profit_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AV Profit_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="AV Profit_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AV Profit_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AV Profit_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setting-up" id="toc-setting-up" class="nav-link active" data-scroll-target="#setting-up"><span class="header-section-number">1</span> Setting Up</a>
  <ul class="collapse">
  <li><a href="#housekeeping" id="toc-housekeeping" class="nav-link" data-scroll-target="#housekeeping"><span class="header-section-number">1.1</span> Housekeeping</a></li>
  <li><a href="#working-directory" id="toc-working-directory" class="nav-link" data-scroll-target="#working-directory"><span class="header-section-number">1.2</span> Working directory</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries"><span class="header-section-number">1.3</span> Load libraries</a></li>
  <li><a href="#theme-for-plots" id="toc-theme-for-plots" class="nav-link" data-scroll-target="#theme-for-plots"><span class="header-section-number">1.4</span> Theme for plots</a></li>
  </ul></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data"><span class="header-section-number">2</span> Import data</a>
  <ul class="collapse">
  <li><a href="#tomato-av" id="toc-tomato-av" class="nav-link" data-scroll-target="#tomato-av"><span class="header-section-number">2.1</span> Tomato AV</a></li>
  <li><a href="#calculate-tavp_wocp" id="toc-calculate-tavp_wocp" class="nav-link" data-scroll-target="#calculate-tavp_wocp"><span class="header-section-number">2.2</span> Calculate tavp_wocp</a></li>
  <li><a href="#tav-profit-tomato-alone" id="toc-tav-profit-tomato-alone" class="nav-link" data-scroll-target="#tav-profit-tomato-alone"><span class="header-section-number">2.3</span> TAV Profit &gt; Tomato Alone</a></li>
  <li><a href="#strawberry-av" id="toc-strawberry-av" class="nav-link" data-scroll-target="#strawberry-av"><span class="header-section-number">2.4</span> Strawberry AV</a></li>
  <li><a href="#calculate-sbvp_wocp" id="toc-calculate-sbvp_wocp" class="nav-link" data-scroll-target="#calculate-sbvp_wocp"><span class="header-section-number">2.5</span> Calculate sbvp_wocp</a></li>
  <li><a href="#sbav-profit-strawberry-alone" id="toc-sbav-profit-strawberry-alone" class="nav-link" data-scroll-target="#sbav-profit-strawberry-alone"><span class="header-section-number">2.6</span> SBAV Profit &gt; Strawberry Alone</a></li>
  <li><a href="#squash-av" id="toc-squash-av" class="nav-link" data-scroll-target="#squash-av"><span class="header-section-number">2.7</span> Squash AV</a></li>
  <li><a href="#calculate-sqvp_wocp" id="toc-calculate-sqvp_wocp" class="nav-link" data-scroll-target="#calculate-sqvp_wocp"><span class="header-section-number">2.8</span> Calculate sqvp_wocp</a></li>
  <li><a href="#sqav-profit-squash-alone" id="toc-sqav-profit-squash-alone" class="nav-link" data-scroll-target="#sqav-profit-squash-alone"><span class="header-section-number">2.9</span> SQAV Profit &gt; Squash Alone</a></li>
  </ul></li>
  <li><a href="#tomato-av-results" id="toc-tomato-av-results" class="nav-link" data-scroll-target="#tomato-av-results"><span class="header-section-number">3</span> Tomato AV Results</a>
  <ul class="collapse">
  <li><a href="#tav_profit-crosstab-64815" id="toc-tav_profit-crosstab-64815" class="nav-link" data-scroll-target="#tav_profit-crosstab-64815"><span class="header-section-number">3.1</span> tav_profit Crosstab (648*15)</a></li>
  <li><a href="#tav_profit-crosstab-32430" id="toc-tav_profit-crosstab-32430" class="nav-link" data-scroll-target="#tav_profit-crosstab-32430"><span class="header-section-number">3.2</span> tav_profit Crosstab (324*30)</a></li>
  <li><a href="#tav_profit-heatmap" id="toc-tav_profit-heatmap" class="nav-link" data-scroll-target="#tav_profit-heatmap"><span class="header-section-number">3.3</span> tav_profit Heatmap</a></li>
  <li><a href="#tavp_wocp-crosstab" id="toc-tavp_wocp-crosstab" class="nav-link" data-scroll-target="#tavp_wocp-crosstab"><span class="header-section-number">3.4</span> tavp_wocp Crosstab</a></li>
  <li><a href="#tavp_wocp-heatmap" id="toc-tavp_wocp-heatmap" class="nav-link" data-scroll-target="#tavp_wocp-heatmap"><span class="header-section-number">3.5</span> tavp_wocp Heatmap</a></li>
  <li><a href="#tavp_be_yld-crosstab" id="toc-tavp_be_yld-crosstab" class="nav-link" data-scroll-target="#tavp_be_yld-crosstab"><span class="header-section-number">3.6</span> tavp_be_yld Crosstab</a></li>
  <li><a href="#tavp_be_yld-heatmap" id="toc-tavp_be_yld-heatmap" class="nav-link" data-scroll-target="#tavp_be_yld-heatmap"><span class="header-section-number">3.7</span> tavp_be_yld Heatmap</a></li>
  <li><a href="#plotting-tomato-profits-by-panels" id="toc-plotting-tomato-profits-by-panels" class="nav-link" data-scroll-target="#plotting-tomato-profits-by-panels"><span class="header-section-number">3.8</span> Plotting Tomato Profits by Panels</a></li>
  <li><a href="#plotting-tomato-profits-by-yields" id="toc-plotting-tomato-profits-by-yields" class="nav-link" data-scroll-target="#plotting-tomato-profits-by-yields"><span class="header-section-number">3.9</span> Plotting Tomato Profits by Yields</a></li>
  </ul></li>
  <li><a href="#strawberry-av-results" id="toc-strawberry-av-results" class="nav-link" data-scroll-target="#strawberry-av-results"><span class="header-section-number">4</span> Strawberry AV Results</a>
  <ul class="collapse">
  <li><a href="#sbav_profit-crosstab-64815" id="toc-sbav_profit-crosstab-64815" class="nav-link" data-scroll-target="#sbav_profit-crosstab-64815"><span class="header-section-number">4.1</span> sbav_profit Crosstab (648*15)</a></li>
  <li><a href="#sbav_profit-crosstab-32430" id="toc-sbav_profit-crosstab-32430" class="nav-link" data-scroll-target="#sbav_profit-crosstab-32430"><span class="header-section-number">4.2</span> sbav_profit Crosstab (324*30)</a></li>
  <li><a href="#sbav_profit-heatmap" id="toc-sbav_profit-heatmap" class="nav-link" data-scroll-target="#sbav_profit-heatmap"><span class="header-section-number">4.3</span> sbav_profit Heatmap</a></li>
  <li><a href="#sbavp_wocp-crosstab" id="toc-sbavp_wocp-crosstab" class="nav-link" data-scroll-target="#sbavp_wocp-crosstab"><span class="header-section-number">4.4</span> sbavp_wocp Crosstab</a></li>
  <li><a href="#sbavp_wocp-heatmap" id="toc-sbavp_wocp-heatmap" class="nav-link" data-scroll-target="#sbavp_wocp-heatmap"><span class="header-section-number">4.5</span> sbavp_wocp Heatmap</a></li>
  <li><a href="#sbav_be_yld-crosstab" id="toc-sbav_be_yld-crosstab" class="nav-link" data-scroll-target="#sbav_be_yld-crosstab"><span class="header-section-number">4.6</span> sbav_be_yld Crosstab</a></li>
  <li><a href="#sbav_be_yld-heatmap" id="toc-sbav_be_yld-heatmap" class="nav-link" data-scroll-target="#sbav_be_yld-heatmap"><span class="header-section-number">4.7</span> sbav_be_yld Heatmap</a></li>
  <li><a href="#plotting-strawberry-profit-by-panels" id="toc-plotting-strawberry-profit-by-panels" class="nav-link" data-scroll-target="#plotting-strawberry-profit-by-panels"><span class="header-section-number">4.8</span> Plotting Strawberry Profit by Panels</a></li>
  <li><a href="#plotting-strawberry-profit-by-yields" id="toc-plotting-strawberry-profit-by-yields" class="nav-link" data-scroll-target="#plotting-strawberry-profit-by-yields"><span class="header-section-number">4.9</span> Plotting Strawberry Profit by Yields</a></li>
  </ul></li>
  <li><a href="#squash-av-results" id="toc-squash-av-results" class="nav-link" data-scroll-target="#squash-av-results"><span class="header-section-number">5</span> Squash AV Results</a>
  <ul class="collapse">
  <li><a href="#sqav_profit-crosstab-64815" id="toc-sqav_profit-crosstab-64815" class="nav-link" data-scroll-target="#sqav_profit-crosstab-64815"><span class="header-section-number">5.1</span> sqav_profit Crosstab (648*15)</a></li>
  <li><a href="#sqav_profit-crosstab-32430" id="toc-sqav_profit-crosstab-32430" class="nav-link" data-scroll-target="#sqav_profit-crosstab-32430"><span class="header-section-number">5.2</span> sqav_profit Crosstab (324*30)</a></li>
  <li><a href="#sqav_profit-heatmap" id="toc-sqav_profit-heatmap" class="nav-link" data-scroll-target="#sqav_profit-heatmap"><span class="header-section-number">5.3</span> sqav_profit Heatmap</a></li>
  <li><a href="#sqavp_wocp-crosstab" id="toc-sqavp_wocp-crosstab" class="nav-link" data-scroll-target="#sqavp_wocp-crosstab"><span class="header-section-number">5.4</span> sqavp_wocp Crosstab</a></li>
  <li><a href="#sqavp_wocp-heatmap" id="toc-sqavp_wocp-heatmap" class="nav-link" data-scroll-target="#sqavp_wocp-heatmap"><span class="header-section-number">5.5</span> sqavp_wocp Heatmap</a></li>
  <li><a href="#sqavp_be_yld-crosstab" id="toc-sqavp_be_yld-crosstab" class="nav-link" data-scroll-target="#sqavp_be_yld-crosstab"><span class="header-section-number">5.6</span> sqavp_be_yld Crosstab</a></li>
  <li><a href="#sqavp_be_yld-heatmap" id="toc-sqavp_be_yld-heatmap" class="nav-link" data-scroll-target="#sqavp_be_yld-heatmap"><span class="header-section-number">5.7</span> sqavp_be_yld Heatmap</a></li>
  <li><a href="#plotting-squash-profit-by-panels" id="toc-plotting-squash-profit-by-panels" class="nav-link" data-scroll-target="#plotting-squash-profit-by-panels"><span class="header-section-number">5.8</span> Plotting Squash Profit by Panels</a></li>
  <li><a href="#plotting-squash-profit-by-yields" id="toc-plotting-squash-profit-by-yields" class="nav-link" data-scroll-target="#plotting-squash-profit-by-yields"><span class="header-section-number">5.9</span> Plotting Squash Profit by Yields</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="AV-Profit.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="AV Profit.ipynb" download="AV Profit.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AV Profit</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bijesh Mishra, Ph.D. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<p>Analysis in this file start by loading data saved after simulating tomato, strawberry, and squash AV profits. See simulation file for more details. The result tables I have here are quite big. Results are summarized in separate excel file (Results.xlsx).</p>
<section id="setting-up" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setting Up</h1>
<section id="housekeeping" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="housekeeping"><span class="header-section-number">1.1</span> Housekeeping</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #| echo: TRUE</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># Clean the environment.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">warn=</span><span class="dv">0</span>, <span class="co"># Warnings. options(warn=-1) / options(warn=0)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">scipen=</span><span class="dv">999</span> <span class="co"># No scientific notations.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="working-directory" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="working-directory"><span class="header-section-number">1.2</span> Working directory</h2>
<p>Codes and output are suppressed. Errors and warnings are visible. No warning and no error means code is working as it should.</p>
</section>
<section id="load-libraries" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="load-libraries"><span class="header-section-number">1.3</span> Load libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(likert,  <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># Likert Items</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice,  <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx2, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># Scatter plot</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels,  <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># Crosstab</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># Reshape data</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman,  <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(progress, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># Progress bar</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># Feather</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Some features are not enabled in this build of Arrow. Run `arrow_info()` for more information.
The repository you retrieved Arrow from did not include all of Arrow's features.
You can install a fully-featured version by running:
`install.packages('arrow', repos = 'https://apache.r-universe.dev')`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot3D, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>) <span class="co"># 3D plotting</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_loaded</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "data.table" "pheatmap"   "furrr"      "future"     "lattice"   
 [6] "plotly"     "plot3D"     "arrow"      "progress"   "pacman"    
[11] "reshape2"   "gmodels"    "ggpubr"     "openxlsx2"  "mice"      
[16] "likert"     "xtable"     "psych"      "lubridate"  "forcats"   
[21] "stringr"    "dplyr"      "purrr"      "readr"      "tidyr"     
[26] "tibble"     "ggplot2"    "tidyverse" </code></pre>
</div>
</div>
</section>
<section id="theme-for-plots" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="theme-for-plots"><span class="header-section-number">1.4</span> Theme for plots</h2>
<p>Setting theme for plots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">####### Plotting Data: #####</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Map Theme:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plottheme <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mapping theme:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">r =</span> <span class="dv">0</span>, </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">b =</span> <span class="dv">0</span>, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">l =</span> <span class="dv">0</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">unit =</span> <span class="st">"cm"</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.x.top =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.y.right =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.x.bottom =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.y.left =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="dv">0</span>),</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Text formatting:</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="co"># font</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> <span class="dv">12</span>, <span class="co"># font size</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>                            <span class="at">colour =</span> <span class="st">"black"</span><span class="co"># font color</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="sc">-</span><span class="fl">0.05</span>),</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">fill =</span> <span class="cn">NA</span>, </span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> <span class="fl">0.05</span>, </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"right"</span>,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="import-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Import data</h1>
<p>Import necessary data.</p>
<section id="tomato-av" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="tomato-av"><span class="header-section-number">2.1</span> Tomato AV</h2>
<p>Parameters defining agrivoltaic systems:</p>
<ul>
<li><p>sprop = proportion of solar in agrivoltaic system (0 to 1 in 0.5 increment.) Length = 21.</p></li>
<li><p>panels = number of solar panels. Length = 16. Some sprop have same number of panels.</p></li>
<li><p>al_regs = four regions of Alabama. Northern, Central, Black Belt, Southern. Length = 4.</p></li>
<li><p>array = Solar array; Sun tracking (Tracking) and non-tracking (Fixed). Length = 2.</p></li>
<li><p>elecprc = electricity price (1 cents to 6 cents). Length = 6.</p></li>
<li><p>height = clearance height of solar panels. 4.6 ft., 6.4 ft., and 8.2 ft. Length = 3.</p></li>
<li><p>yldvar = crop yield variation (10% to 200%) = Length 21.</p></li>
<li><p>yield = crop yield variation based on yldvar. (same as yldvar) = Length = 21.</p></li>
</ul>
<p>Calculated results using above parameters:</p>
<ul>
<li><p>dc_kw = DC system size (kW) See <a href="https://pvwatts.nrel.gov/pvwatts.php">PVWatts® Calculator</a>.</p></li>
<li><p>energy = total energy generated from solar system. See: <a href="https://pvwatts.nrel.gov/pvwatts.php">PVWatts® Calculator</a>.</p></li>
<li><p>capex = AV system capex per kW. See: <a href="https://www.nrel.gov/docs/fy21osti/77811.pdf">Capex Cost for AV</a> table 1 and table 3.</p></li>
<li><p>ttlcost = total solar system cost in AV. See: <a href="https://www.nrel.gov/docs/fy21osti/77811.pdf">Capex Cost for AV</a> table 1 and table 3.</p></li>
<li><p>anncost = annualized total cost.</p></li>
<li><p>moncost = monthly total cost.</p></li>
<li><p>price = crop yield price per bucket.</p></li>
<li><p>eprofit = profit from electricity.</p></li>
</ul>
<p>Result of Interests:</p>
<ul>
<li><p>eannprof = annualized total profit from electricity.</p></li>
<li><p>emonprof = monthly total profit from electricity.</p></li>
<li><p>profit = profit from crops.</p></li>
<li><p>tav_profit = total profit from solar and tomato.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tav_profit <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_feather</span>(<span class="at">file =</span> <span class="st">"Data/tav_profit.feather"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#str(tav_profit)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#head(tav_profit); head(tav_profit)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tav_profit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 776160     21</code></pre>
</div>
</div>
</section>
<section id="calculate-tavp_wocp" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="calculate-tavp_wocp"><span class="header-section-number">2.2</span> Calculate tavp_wocp</h2>
<ul>
<li><p>Profit at 100% crop at their respective price is subtracted from tav_profit.</p></li>
<li><p>tavp_wocp = tav_profit - profit from 100% crop at their respective prices. This variable gives an idea where av profit stands in relation to crop profit. It helps to identify relative profitability of agrivoltaic system compared to crop only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the profit:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Filter the dataframe to get the unique profit values for each price when yldvar is 1</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>unique_profits <span class="ot">&lt;-</span> <span class="fu">unique</span>(tav_profit[tav_profit<span class="sc">$</span>yldvar <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="st">"price"</span>, <span class="st">"profit"</span>)])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create a lookup table for unique profits by price</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>profit_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(unique_profits<span class="sc">$</span>profit, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                          unique_profits<span class="sc">$</span>price)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create the new variable tavp_wocp by subtracting the unique profit from tav_profit</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>tav_profit<span class="sc">$</span>tavp_wocp <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="cf">function</span>(tav_profit, price) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  profit_to_subtract <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(price <span class="sc">%in%</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">names</span>(profit_lookup), </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                               profit_lookup[<span class="fu">as.character</span>(price)], <span class="dv">0</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tav_profit <span class="sc">-</span> profit_to_subtract)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>}, tav_profit<span class="sc">$</span>tav_profit, tav_profit<span class="sc">$</span>price)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(unique_profits); <span class="fu">rm</span>(profit_lookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="tav-profit-tomato-alone" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="tav-profit-tomato-alone"><span class="header-section-number">2.3</span> TAV Profit &gt; Tomato Alone</h2>
<p>Tomato yield where tomato AV start becoming more profitable than tomato alone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data frame to a data.table for faster operations</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(tav_profit)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process each subset</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>process_subset <span class="ot">&lt;-</span> <span class="cf">function</span>(subset) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  subset <span class="ot">&lt;-</span> subset[<span class="fu">order</span>(<span class="sc">-</span>tavp_wocp)]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the row where yield changes from positive to negative</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  change_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(subset<span class="sc">$</span>tavp_wocp)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>)[<span class="dv">1</span>]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if change_row is not NA</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(change_row)) {</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    result_row <span class="ot">&lt;-</span> subset[change_row, ]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result_row)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data by unique combinations of the filtering criteria</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(tav_profit, </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"array"</span>, <span class="st">"sprop"</span>, </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"elcprc"</span>, <span class="st">"price"</span>, <span class="st">"height"</span>))</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the process_subset function in parallel</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(split_data, </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                    process_subset, </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mc.cores =</span> <span class="fu">detectCores</span>())</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all results into a single data.table</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>tav_be_yld <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(results, </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">use.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(al_regs, array, sprop,panels, elcprc, price,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>         height, profit, yldvar, yield, tav_profit, tavp_wocp)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(results); <span class="fu">rm</span>(split_data); <span class="fu">rm</span>(process_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(tav_be_yld),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#col.names = TRUE,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/tav_brkevn_yield.csv"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tav_be_yld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27048    12</code></pre>
</div>
</div>
</section>
<section id="strawberry-av" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="strawberry-av"><span class="header-section-number">2.4</span> Strawberry AV</h2>
<p>See tomato for variable descriptions.</p>
<p>sbav_profit = total profit from solar and strawberry.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sbav_profit <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_feather</span>(<span class="at">file =</span> <span class="st">"Data/sbav_profit.feather"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#str(sbav_profit)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#head(sbav_profit); tail(sbav_profit)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sbav_profit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 776160     21</code></pre>
</div>
</div>
</section>
<section id="calculate-sbvp_wocp" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="calculate-sbvp_wocp"><span class="header-section-number">2.5</span> Calculate sbvp_wocp</h2>
<ul>
<li><p>Profit at 100% crop at their respective price is subtracted from sbav_profit.</p></li>
<li><p>sbavp_wocp = sbav_profit - profit from 100% crop at their respective prices. This variable gives an idea where av profit stands in relation to crop profit. It helps to identify relative profitability of agrivoltaic system compared to crop only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the profit:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Filter the dataframe to get the unique profit values for each price when yldvar is 1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>unique_profits <span class="ot">&lt;-</span> <span class="fu">unique</span>(sbav_profit[sbav_profit<span class="sc">$</span>yldvar <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="st">"price"</span>, <span class="st">"profit"</span>)])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create a lookup table for unique profits by price</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>profit_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(unique_profits<span class="sc">$</span>profit, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                          unique_profits<span class="sc">$</span>price)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create the new variable sbavp_wocp by subtracting the unique profit from sqav_profit</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>sbav_profit<span class="sc">$</span>sbavp_wocp <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="cf">function</span>(sbav_profit, price) {</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  profit_to_subtract <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(price <span class="sc">%in%</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">names</span>(profit_lookup), </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                               profit_lookup[<span class="fu">as.character</span>(price)], <span class="dv">0</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sbav_profit <span class="sc">-</span> profit_to_subtract)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>}, sbav_profit<span class="sc">$</span>sbav_profit, sbav_profit<span class="sc">$</span>price)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(unique_profits); <span class="fu">rm</span>(profit_lookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="sbav-profit-strawberry-alone" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="sbav-profit-strawberry-alone"><span class="header-section-number">2.6</span> SBAV Profit &gt; Strawberry Alone</h2>
<p>Strawberry yield where strawberry AV profit start becoming more profitable than strawberry alone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data frame to a data.table for faster operations</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(sbav_profit)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process each subset</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>process_subset <span class="ot">&lt;-</span> <span class="cf">function</span>(subset) {</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  subset <span class="ot">&lt;-</span> subset[<span class="fu">order</span>(<span class="sc">-</span>sbavp_wocp)]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the row where yield changes from positive to negative</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  change_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(subset<span class="sc">$</span>sbavp_wocp)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>)[<span class="dv">1</span>]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if change_row is not NA</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(change_row)) {</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    result_row <span class="ot">&lt;-</span> subset[change_row, ]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result_row)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data by unique combinations of the filtering criteria</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(sbav_profit, </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"array"</span>, <span class="st">"sprop"</span>, </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"elcprc"</span>, <span class="st">"price"</span>, <span class="st">"height"</span>))</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the process_subset function in parallel</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(split_data, </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                    process_subset, </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mc.cores =</span> <span class="fu">detectCores</span>())</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all results into a single data.table</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>sbav_be_yld <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(results, </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">use.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(al_regs, array, sprop,panels, elcprc, price,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>         height, profit, yldvar, yield, sbav_profit, sbavp_wocp)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(results); <span class="fu">rm</span>(split_data); <span class="fu">rm</span>(process_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(sbav_be_yld),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#col.names = TRUE,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/sbav_brkevn_yield.csv"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sbav_be_yld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21363    12</code></pre>
</div>
</div>
</section>
<section id="squash-av" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="squash-av"><span class="header-section-number">2.7</span> Squash AV</h2>
<ul>
<li><p>See tomato for variable descriptions.</p></li>
<li><p>sqav_profit = total profit from solar and squash.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sqav_profit <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_feather</span>(<span class="at">file =</span> <span class="st">"Data/sqav_profit.feather"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#head(sqav_profit); tail(sqav_profit)</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sqav_profit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 776160     21</code></pre>
</div>
</div>
</section>
<section id="calculate-sqvp_wocp" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="calculate-sqvp_wocp"><span class="header-section-number">2.8</span> Calculate sqvp_wocp</h2>
<ul>
<li><p>Profit at 100% crop at their respective price is subtracted from sqav_profit.</p></li>
<li><p>sqavp_wocp = sbav_profit - profit from 100% crop at their respective prices. This variable gives an idea where av profit stands in relation to crop profit. It helps to identify relative profitability of agrivoltaic system compared to crop only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the profit:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Filter the dataframe to get the unique profit values for each price when yldvar is 1</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>unique_profits <span class="ot">&lt;-</span> <span class="fu">unique</span>(sqav_profit[sqav_profit<span class="sc">$</span>yldvar <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="st">"price"</span>, <span class="st">"profit"</span>)])</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create a lookup table for unique profits by price</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>profit_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(unique_profits<span class="sc">$</span>profit, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                          unique_profits<span class="sc">$</span>price)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create the new variable sbavp_wocp by subtracting the unique profit from sqav_profit</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>sqav_profit<span class="sc">$</span>sqavp_wocp <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="cf">function</span>(sqav_profit, price) {</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  profit_to_subtract <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(price <span class="sc">%in%</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">names</span>(profit_lookup), </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                               profit_lookup[<span class="fu">as.character</span>(price)], <span class="dv">0</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sqav_profit <span class="sc">-</span> profit_to_subtract)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>}, sqav_profit<span class="sc">$</span>sqav_profit, sqav_profit<span class="sc">$</span>price)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(unique_profits); <span class="fu">rm</span>(profit_lookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="sqav-profit-squash-alone" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="sqav-profit-squash-alone"><span class="header-section-number">2.9</span> SQAV Profit &gt; Squash Alone</h2>
<p>Summer squash yield where squash AV profit start becoming more profitable than squash alone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data frame to a data.table for faster operations</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(sqav_profit)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process each subset</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>process_subset <span class="ot">&lt;-</span> <span class="cf">function</span>(subset) {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  subset <span class="ot">&lt;-</span> subset[<span class="fu">order</span>(<span class="sc">-</span>sqavp_wocp)]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the row where yield changes from positive to negative</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  change_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(subset<span class="sc">$</span>sqavp_wocp)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>)[<span class="dv">1</span>]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if change_row is not NA</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(change_row)) {</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    result_row <span class="ot">&lt;-</span> subset[change_row, ]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result_row)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data by unique combinations of the filtering criteria</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(sqav_profit, </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"array"</span>, <span class="st">"sprop"</span>, </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"elcprc"</span>, <span class="st">"price"</span>, <span class="st">"height"</span>))</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the process_subset function in parallel</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(split_data, </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                    process_subset, </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mc.cores =</span> <span class="fu">detectCores</span>())</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all results into a single data.table</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>sqav_be_yld <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(results, </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">use.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(al_regs, array, sprop,panels, elcprc, price,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>         height, profit, yldvar, yield, sqav_profit, sqavp_wocp)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(results); <span class="fu">rm</span>(split_data); <span class="fu">rm</span>(process_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(sqav_be_yld),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#col.names = TRUE,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/sqav_brkevn_yield.csv"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sqav_be_yld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16857    12</code></pre>
</div>
</div>
</section>
</section>
<section id="tomato-av-results" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Tomato AV Results</h1>
<section id="tav_profit-crosstab-64815" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="tav_profit-crosstab-64815"><span class="header-section-number">3.1</span> tav_profit Crosstab (648*15)</h2>
<ul>
<li><p>Row naming: Electricity Price_Crop Price_Solar Proportion_Alabama Regions.</p></li>
<li><p>Column naming: Solar Proportion_Array Types_Solar Panel Height.</p></li>
<li><p>Solar Proportion can be converted to total number of panels.</p></li>
<li><p>Only selected values from each variables are extracted for tabulation purpose.</p></li>
<li><p>Values displayed in the table are profit from Tomato AV system.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>) <span class="co"># Solar Array</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>) <span class="co"># Panel height</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>) <span class="co"># Regions of AL</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>) <span class="co"># Crop Price</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>) <span class="co"># Electricity Price</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, <span class="st">"al_regs"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(tav_profit))</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in tav_profit: "</span>, </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using expand.grid without array</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, sprop),</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">2</span>], <span class="st">"%_"</span>, x[<span class="dv">1</span>]))</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using expand.grid with array included</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, price, </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, al_regs, array), <span class="dv">1</span>, </span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>], <span class="st">"_"</span>,</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">3</span>], <span class="st">"_"</span>, </span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">2</span>], <span class="st">"_"</span>, </span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">1</span>], <span class="st">"_"</span>, </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">5</span>]))</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, </span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="fu">length</span>(row_names),</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with all combinations of parameters</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get av_profit values for each combination</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>                     tav_profit, </span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>,</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, </span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"price"</span>, <span class="st">"elcprc"</span>), </span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with adjusted column and row names</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], <span class="st">"%_"</span>, x[<span class="dv">2</span>]))</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, </span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"price"</span>, <span class="st">"elcprc"</span>, </span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"array"</span>)], <span class="dv">1</span>, </span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], <span class="st">"_"</span>,</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">2</span>], <span class="st">"_"</span>, </span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">3</span>], <span class="st">"_"</span>, </span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">4</span>], <span class="st">"_"</span>, </span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">5</span>]))</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with av_profit values</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span> (</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>                             row_data<span class="sc">$</span>tav_profit, <span class="dv">2</span>)</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result matrix</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>ct_tav_pft64815 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix); <span class="fu">rm</span>(sprop); <span class="fu">rm</span>(array); <span class="fu">rm</span>(height); </span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(elcprc); <span class="fu">rm</span>(price); <span class="fu">rm</span>(yldvar); <span class="fu">rm</span>(al_regs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tav_profit-crosstab-32430" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="tav_profit-crosstab-32430"><span class="header-section-number">3.2</span> tav_profit Crosstab (324*30)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>) <span class="co"># Solar Array</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>) <span class="co"># Panel height</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>) <span class="co"># Regions of AL</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>) <span class="co"># Crop Price</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>) <span class="co"># Electricity Price</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(tav_profit))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in tav_profit: "</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, </span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get tav_profit values for each combination</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>                     tav_profit, </span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>]))</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with tav_profit values</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>tav_profit, <span class="dv">2</span>)</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>ct_tav_pft <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a><span class="co">#Shape crosstab.</span></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result matrix</span></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix); <span class="fu">rm</span>(sprop); <span class="fu">rm</span>(array); <span class="fu">rm</span>(height); </span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(elcprc); <span class="fu">rm</span>(price); <span class="fu">rm</span>(yldvar); <span class="fu">rm</span>(al_regs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_tav_pft),</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_tav_profit.csv"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_tav_pft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
</div>
</section>
<section id="tav_profit-heatmap" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="tav_profit-heatmap"><span class="header-section-number">3.3</span> tav_profit Heatmap</h2>
<ul>
<li>Heatmap of 324*30 dimension matrix</li>
<li>Tomato profit.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_tav_pft[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 148954</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_tav_pft),</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">border_color =</span> <span class="st">"black"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 16,</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">limitsize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_tav_pft"</span>, <span class="st">".png"</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(colorcount); rm(heatmap_plot)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tavp_wocp-crosstab" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="tavp_wocp-crosstab"><span class="header-section-number">3.4</span> tavp_wocp Crosstab</h2>
<ul>
<li><p>Heatmap of 324*30 dimension matrix.</p></li>
<li><p>See tav_profit for variable naming convention.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>) <span class="co"># Solar Array</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>) <span class="co"># Panel height</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>) <span class="co"># Regions of AL</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>) <span class="co"># Crop Price</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>) <span class="co"># Electricity Price</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(tav_profit))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in tavp_wocp: "</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get tav_profit values for each combination</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>                     tav_profit, </span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>]))</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with tav_profit values</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>tavp_wocp, <span class="dv">2</span>)</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>ct_tavp_wocp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_tavp_wocp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_tavp_wocp),</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_tavp_wocp.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tavp_wocp-heatmap" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="tavp_wocp-heatmap"><span class="header-section-number">3.5</span> tavp_wocp Heatmap</h2>
<ul>
<li>Heatmap of 324*30 dimension matrix.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_tavp_wocp[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 142583</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_tavp_wocp),</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_tavp_wocp"</span>, <span class="st">".png"</span>))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot); <span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tavp_be_yld-crosstab" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="tavp_be_yld-crosstab"><span class="header-section-number">3.6</span> tavp_be_yld Crosstab</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>) <span class="co"># Solar Array</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>) <span class="co"># Panel height</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>) <span class="co"># Regions of AL</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>) <span class="co"># Crop Price</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>) <span class="co"># Electricity Price</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(tav_be_yld))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in tavp_be_yld: "</span>,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_be_yld to get tav_be_yld values for each combination</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>                     tav_be_yld, </span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>]))</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with tav_profit values</span></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>yield, <span class="dv">2</span>)</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>ct_tavp_be_yld <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_tavp_be_yld),</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_tavp_be_yld.csv"</span>)</span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_tavp_be_yld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tavp_be_yld-heatmap" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="tavp_be_yld-heatmap"><span class="header-section-number">3.7</span> tavp_be_yld Heatmap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_tavp_be_yld[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_tavp_be_yld),</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_tavp_be_yld"</span>, <span class="st">".png"</span>))</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot); <span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-tomato-profits-by-panels" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="plotting-tomato-profits-by-panels"><span class="header-section-number">3.8</span> Plotting Tomato Profits by Panels</h2>
<p>You can see plot breakdown based on yield variation, crop price, and electricity price. You can see variation for all solar proportion in one facet of the chart. Each facet of the chart contain av profit three heights of solar panels, four regions of AL, two array types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">yldvar =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.20</span>, <span class="fl">1.5</span>, <span class="fl">1.80</span>, <span class="dv">2</span>), <span class="co"># Yield variation</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">23</span>), <span class="co"># Tomato price</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">elcprc =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>) <span class="co">#Electricity price</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the combinations and create the plots</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (combo <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(combinations))) {</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> tav_profit <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>      yldvar <span class="sc">==</span> combinations<span class="sc">$</span>yldvar[combo],</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>      price <span class="sc">==</span> combinations<span class="sc">$</span>price[combo],</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>      elcprc <span class="sc">==</span> combinations<span class="sc">$</span>elcprc[combo]</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If by panel, put panels below in color and group.</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  tav_sp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> filtered_data,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> al_regs,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> tav_profit,</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> <span class="fu">factor</span>(panels),</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">group =</span> <span class="fu">factor</span>(panels))) <span class="sc">+</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(height <span class="sc">~</span> array,</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4.6"</span> <span class="ot">=</span> <span class="st">"4.6 ft. Height"</span>,</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6.4"</span> <span class="ot">=</span> <span class="st">"6.4 ft. Height"</span>,</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8.2"</span> <span class="ot">=</span> <span class="st">"8.2 ft. Height"</span>,</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tracking =</span> <span class="st">"Single Axis Rotation"</span>, </span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Fixed =</span> <span class="st">"Fixed Open Rack"</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>                   ))) <span class="sc">+</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>,</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>), </span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"Center"</span>, </span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"B Belt"</span>, <span class="st">"South"</span>)) <span class="sc">+</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Regions of Alabama"</span>,</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Profit ($) from Tomato Agrivoltaic System"</span>,</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Number of Solar </span><span class="sc">\n</span><span class="st"> Panels per Acre"</span>,</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> (<span class="fu">list</span>(combinations[combo,]))</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add horizontal line at y = 0 if y has both positive and negative values</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(filtered_data<span class="sc">$</span>tav_profit) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(filtered_data<span class="sc">$</span>tav_profit) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>    tav_sp_plot <span class="ot">&lt;-</span> tav_sp_plot <span class="sc">+</span> </span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.30</span>, </span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combinations[combo,])</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tav_sp_plot)</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/tav_sp_"</span>, combo, <span class="st">".png"</span>))</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#break</span></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
1    0.1    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
2    0.3    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
3    0.5    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
4    0.7    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
5      1    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
6    1.2    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
7    1.5    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
8    1.8    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
9      2    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
10    0.1    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
11    0.3    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
12    0.5    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
13    0.7    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
14      1    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
15    1.2    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
16    1.5    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
17    1.8    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
18      2    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
19    0.1    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
20    0.3    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
21    0.5    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
22    0.7    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
23      1    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
24    1.2    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
25    1.5    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
26    1.8    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
27      2    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
28    0.1    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
29    0.3    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
30    0.5    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
31    0.7    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
32      1    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
33    1.2    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
34    1.5    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
35    1.8    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
36      2    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
37    0.1    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
38    0.3    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
39    0.5    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
40    0.7    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
41      1    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
42    1.2    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
43    1.5    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
44    1.8    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
45      2    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-45.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
46    0.1    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-46.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
47    0.3    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-47.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
48    0.5    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-48.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
49    0.7    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-49.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
50      1    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-50.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
51    1.2    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-51.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
52    1.5    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-52.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
53    1.8    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-53.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
54      2    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-54.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
55    0.1    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-55.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
56    0.3    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-56.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
57    0.5    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-57.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
58    0.7    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-58.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
59      1    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-59.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
60    1.2    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-60.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
61    1.5    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-61.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
62    1.8    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-62.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
63      2    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-63.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
64    0.1    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-64.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
65    0.3    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-65.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
66    0.5    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-66.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
67    0.7    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-67.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
68      1    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-68.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
69    1.2    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-69.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
70    1.5    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-70.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
71    1.8    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-71.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
72      2    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-72.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
73    0.1    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-73.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
74    0.3    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-74.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
75    0.5    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-75.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
76    0.7    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-76.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
77      1    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-77.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
78    1.2    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-78.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
79    1.5    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-79.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
80    1.8    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-80.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
81      2    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-30-81.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-tomato-profits-by-yields" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="plotting-tomato-profits-by-yields"><span class="header-section-number">3.9</span> Plotting Tomato Profits by Yields</h2>
<p>You can see plot breakdown based on solar proportion, crop price, and electricity price. You can see variation for all crop yield variation in one facet of the chart. Each facet of the chart contain av profit three heights of solar panels, four regions of AL, two array types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sprop =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.00</span>), <span class="co"># Solar proportion</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">23</span>), <span class="co"># Tomato price</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">elcprc =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>) <span class="co">#Electricity price</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the combinations and create the plots</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (combo <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(combinations))) {</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> tav_profit <span class="sc">%&gt;%</span></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a>      sprop <span class="sc">==</span> combinations<span class="sc">$</span>sprop[combo],</span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>      price <span class="sc">==</span> combinations<span class="sc">$</span>price[combo],</span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>      elcprc <span class="sc">==</span> combinations<span class="sc">$</span>elcprc[combo]</span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If by yield, put yield below in color and group.</span></span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a>  tav_yv_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> filtered_data,</span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> al_regs,</span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> tav_profit,</span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> <span class="fu">factor</span>(yield),</span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">group =</span> <span class="fu">factor</span>(yield))) <span class="sc">+</span></span>
<span id="cb214-21"><a href="#cb214-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb214-22"><a href="#cb214-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb214-23"><a href="#cb214-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(height <span class="sc">~</span> array,</span>
<span id="cb214-24"><a href="#cb214-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb214-25"><a href="#cb214-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(</span>
<span id="cb214-26"><a href="#cb214-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4.6"</span> <span class="ot">=</span> <span class="st">"4.6 ft. Height"</span>,</span>
<span id="cb214-27"><a href="#cb214-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6.4"</span> <span class="ot">=</span> <span class="st">"6.4 ft. Height"</span>,</span>
<span id="cb214-28"><a href="#cb214-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8.2"</span> <span class="ot">=</span> <span class="st">"8.2 ft. Height"</span>,</span>
<span id="cb214-29"><a href="#cb214-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tracking =</span> <span class="st">"Single Axis Rotation"</span>, </span>
<span id="cb214-30"><a href="#cb214-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Fixed =</span> <span class="st">"Fixed Open Rack"</span></span>
<span id="cb214-31"><a href="#cb214-31" aria-hidden="true" tabindex="-1"></a>                   ))) <span class="sc">+</span></span>
<span id="cb214-32"><a href="#cb214-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb214-33"><a href="#cb214-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb214-34"><a href="#cb214-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>,</span>
<span id="cb214-35"><a href="#cb214-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>), </span>
<span id="cb214-36"><a href="#cb214-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"Center"</span>, </span>
<span id="cb214-37"><a href="#cb214-37" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"B Belt"</span>, <span class="st">"South"</span>)) <span class="sc">+</span></span>
<span id="cb214-38"><a href="#cb214-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb214-39"><a href="#cb214-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb214-40"><a href="#cb214-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Regions of Alabama"</span>,</span>
<span id="cb214-41"><a href="#cb214-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Profit ($) from Tomato Agrivoltaic System"</span>,</span>
<span id="cb214-42"><a href="#cb214-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Tomato Yield </span><span class="sc">\n</span><span class="st"> (25 Lb Buckets)"</span>,</span>
<span id="cb214-43"><a href="#cb214-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> (<span class="fu">list</span>(combinations[combo,]))</span>
<span id="cb214-44"><a href="#cb214-44" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb214-45"><a href="#cb214-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb214-46"><a href="#cb214-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add horizontal line at y = 0 if y has both positive and negative values</span></span>
<span id="cb214-47"><a href="#cb214-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(filtered_data<span class="sc">$</span>tav_profit) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb214-48"><a href="#cb214-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(filtered_data<span class="sc">$</span>tav_profit) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb214-49"><a href="#cb214-49" aria-hidden="true" tabindex="-1"></a>    tav_yv_plot <span class="ot">&lt;-</span> tav_yv_plot <span class="sc">+</span> </span>
<span id="cb214-50"><a href="#cb214-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb214-51"><a href="#cb214-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.30</span>, </span>
<span id="cb214-52"><a href="#cb214-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb214-53"><a href="#cb214-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb214-54"><a href="#cb214-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb214-55"><a href="#cb214-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combinations[combo,])</span>
<span id="cb214-56"><a href="#cb214-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tav_yv_plot)</span>
<span id="cb214-57"><a href="#cb214-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/tav_yv_"</span>, combo, <span class="st">".png"</span>))</span>
<span id="cb214-58"><a href="#cb214-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#break</span></span>
<span id="cb214-59"><a href="#cb214-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
1     0    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
2  0.25    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
3   0.5    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
4  0.75    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
5     1    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
6     0    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
7  0.25    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
8   0.5    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
9  0.75    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
10     1    20   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
11     0    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
12  0.25    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
13   0.5    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
14  0.75    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
15     1    23   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
16     0    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
17  0.25    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
18   0.5    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
19  0.75    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
20     1    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
21     0    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
22  0.25    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
23   0.5    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
24  0.75    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
25     1    20   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
26     0    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
27  0.25    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
28   0.5    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
29  0.75    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
30     1    23   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
31     0    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
32  0.25    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
33   0.5    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
34  0.75    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
35     1    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
36     0    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
37  0.25    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
38   0.5    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
39  0.75    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
40     1    20   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
41     0    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
42  0.25    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
43   0.5    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
44  0.75    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
45     1    23   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-31-45.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="strawberry-av-results" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Strawberry AV Results</h1>
<section id="sbav_profit-crosstab-64815" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sbav_profit-crosstab-64815"><span class="header-section-number">4.1</span> sbav_profit Crosstab (648*15)</h2>
<ul>
<li><p>Row naming: Electricity Price_Crop Price_Solar Proportion_Alabama Regions</p></li>
<li><p>Column naming: Solar Proportion_Array Types_Solar Panel Height.</p></li>
<li><p>Solar Proportion can be converted to total number of panels.</p></li>
<li><p>Only selected values from each variables are extracted for tabulation purpose.</p></li>
<li><p>Values displayed in the table are profit from Strawberry AV system.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>)</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>)</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>)</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>)</span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, <span class="st">"al_regs"</span>, </span>
<span id="cb305-14"><a href="#cb305-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb305-15"><a href="#cb305-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-16"><a href="#cb305-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb305-17"><a href="#cb305-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb305-18"><a href="#cb305-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sbav_profit))</span>
<span id="cb305-19"><a href="#cb305-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb305-20"><a href="#cb305-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sbav_profit: "</span>, </span>
<span id="cb305-21"><a href="#cb305-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns,</span>
<span id="cb305-22"><a href="#cb305-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb305-23"><a href="#cb305-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb305-24"><a href="#cb305-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-25"><a href="#cb305-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using expand.grid without array</span></span>
<span id="cb305-26"><a href="#cb305-26" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, sprop), </span>
<span id="cb305-27"><a href="#cb305-27" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>, <span class="cf">function</span>(x) </span>
<span id="cb305-28"><a href="#cb305-28" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">paste0</span>(x[<span class="dv">2</span>], <span class="st">"%_"</span>,</span>
<span id="cb305-29"><a href="#cb305-29" aria-hidden="true" tabindex="-1"></a>                            x[<span class="dv">1</span>]))</span>
<span id="cb305-30"><a href="#cb305-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-31"><a href="#cb305-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using expand.grid with array included</span></span>
<span id="cb305-32"><a href="#cb305-32" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, price, yldvar, al_regs, array),</span>
<span id="cb305-33"><a href="#cb305-33" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>], <span class="st">"_"</span>, </span>
<span id="cb305-34"><a href="#cb305-34" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">3</span>], <span class="st">"_"</span>, </span>
<span id="cb305-35"><a href="#cb305-35" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">2</span>], <span class="st">"_"</span>,</span>
<span id="cb305-36"><a href="#cb305-36" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">1</span>], <span class="st">"_"</span>, </span>
<span id="cb305-37"><a href="#cb305-37" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">5</span>]))</span>
<span id="cb305-38"><a href="#cb305-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-39"><a href="#cb305-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb305-40"><a href="#cb305-40" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, </span>
<span id="cb305-41"><a href="#cb305-41" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb305-42"><a href="#cb305-42" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb305-43"><a href="#cb305-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb305-44"><a href="#cb305-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb305-45"><a href="#cb305-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-46"><a href="#cb305-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with all combinations of parameters</span></span>
<span id="cb305-47"><a href="#cb305-47" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb305-48"><a href="#cb305-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb305-49"><a href="#cb305-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb305-50"><a href="#cb305-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb305-51"><a href="#cb305-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb305-52"><a href="#cb305-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb305-53"><a href="#cb305-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb305-54"><a href="#cb305-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-55"><a href="#cb305-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get av_profit values for each combination</span></span>
<span id="cb305-56"><a href="#cb305-56" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb305-57"><a href="#cb305-57" aria-hidden="true" tabindex="-1"></a>                     sbav_profit, </span>
<span id="cb305-58"><a href="#cb305-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>,</span>
<span id="cb305-59"><a href="#cb305-59" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>,</span>
<span id="cb305-60"><a href="#cb305-60" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"elcprc"</span>),</span>
<span id="cb305-61"><a href="#cb305-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb305-62"><a href="#cb305-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-63"><a href="#cb305-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with adjusted column and row names</span></span>
<span id="cb305-64"><a href="#cb305-64" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"height"</span>)],</span>
<span id="cb305-65"><a href="#cb305-65" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], <span class="st">"%_"</span>,</span>
<span id="cb305-66"><a href="#cb305-66" aria-hidden="true" tabindex="-1"></a>                                                    x[<span class="dv">2</span>]))</span>
<span id="cb305-67"><a href="#cb305-67" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>,</span>
<span id="cb305-68"><a href="#cb305-68" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"elcprc"</span>, <span class="st">"array"</span>)], <span class="dv">1</span>,</span>
<span id="cb305-69"><a href="#cb305-69" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], <span class="st">"_"</span>,</span>
<span id="cb305-70"><a href="#cb305-70" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">2</span>], <span class="st">"_"</span>,</span>
<span id="cb305-71"><a href="#cb305-71" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">3</span>], <span class="st">"_"</span>,</span>
<span id="cb305-72"><a href="#cb305-72" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">4</span>], <span class="st">"_"</span>,</span>
<span id="cb305-73"><a href="#cb305-73" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">5</span>]))</span>
<span id="cb305-74"><a href="#cb305-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-75"><a href="#cb305-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with av_profit values</span></span>
<span id="cb305-76"><a href="#cb305-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb305-77"><a href="#cb305-77" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb305-78"><a href="#cb305-78" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb305-79"><a href="#cb305-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb305-80"><a href="#cb305-80" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, <span class="fu">match</span>(</span>
<span id="cb305-81"><a href="#cb305-81" aria-hidden="true" tabindex="-1"></a>      row_data<span class="sc">$</span>col_name,</span>
<span id="cb305-82"><a href="#cb305-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(row_data<span class="sc">$</span>sbav_profit, <span class="dv">2</span>)</span>
<span id="cb305-83"><a href="#cb305-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb305-84"><a href="#cb305-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-85"><a href="#cb305-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-86"><a href="#cb305-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result matrix</span></span>
<span id="cb305-87"><a href="#cb305-87" aria-hidden="true" tabindex="-1"></a>ct_sbav_pft64815 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb305-88"><a href="#cb305-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sbav_profit-crosstab-32430" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sbav_profit-crosstab-32430"><span class="header-section-number">4.2</span> sbav_profit Crosstab (324*30)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>)</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>)</span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>)</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>)</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in sbav_profit</span></span>
<span id="cb306-17"><a href="#cb306-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb306-18"><a href="#cb306-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sbav_profit))</span>
<span id="cb306-19"><a href="#cb306-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb306-20"><a href="#cb306-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sbav_profit: "</span>,</span>
<span id="cb306-21"><a href="#cb306-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb306-22"><a href="#cb306-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-23"><a href="#cb306-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-24"><a href="#cb306-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb306-25"><a href="#cb306-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb306-26"><a href="#cb306-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb306-27"><a href="#cb306-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-28"><a href="#cb306-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb306-29"><a href="#cb306-29" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb306-30"><a href="#cb306-30" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb306-31"><a href="#cb306-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb306-32"><a href="#cb306-32" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb306-33"><a href="#cb306-33" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb306-34"><a href="#cb306-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-35"><a href="#cb306-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb306-36"><a href="#cb306-36" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, </span>
<span id="cb306-37"><a href="#cb306-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb306-38"><a href="#cb306-38" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb306-39"><a href="#cb306-39" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb306-40"><a href="#cb306-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb306-41"><a href="#cb306-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-42"><a href="#cb306-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with</span></span>
<span id="cb306-43"><a href="#cb306-43" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb306-44"><a href="#cb306-44" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb306-45"><a href="#cb306-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb306-46"><a href="#cb306-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb306-47"><a href="#cb306-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb306-48"><a href="#cb306-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb306-49"><a href="#cb306-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb306-50"><a href="#cb306-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb306-51"><a href="#cb306-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-52"><a href="#cb306-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get sbav_profit values for each combination</span></span>
<span id="cb306-53"><a href="#cb306-53" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb306-54"><a href="#cb306-54" aria-hidden="true" tabindex="-1"></a>                     sbav_profit, </span>
<span id="cb306-55"><a href="#cb306-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb306-56"><a href="#cb306-56" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb306-57"><a href="#cb306-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-58"><a href="#cb306-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb306-59"><a href="#cb306-59" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb306-60"><a href="#cb306-60" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb306-61"><a href="#cb306-61" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb306-62"><a href="#cb306-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>],</span>
<span id="cb306-63"><a href="#cb306-63" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>], </span>
<span id="cb306-64"><a href="#cb306-64" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>]))</span>
<span id="cb306-65"><a href="#cb306-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-66"><a href="#cb306-66" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb306-67"><a href="#cb306-67" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb306-68"><a href="#cb306-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb306-69"><a href="#cb306-69" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb306-70"><a href="#cb306-70" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb306-71"><a href="#cb306-71" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb306-72"><a href="#cb306-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-73"><a href="#cb306-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with sbav_profit values</span></span>
<span id="cb306-74"><a href="#cb306-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb306-75"><a href="#cb306-75" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb306-76"><a href="#cb306-76" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb306-77"><a href="#cb306-77" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb306-78"><a href="#cb306-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb306-79"><a href="#cb306-79" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb306-80"><a href="#cb306-80" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb306-81"><a href="#cb306-81" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb306-82"><a href="#cb306-82" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>sbav_profit, <span class="dv">2</span>)</span>
<span id="cb306-83"><a href="#cb306-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb306-84"><a href="#cb306-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-85"><a href="#cb306-85" aria-hidden="true" tabindex="-1"></a>ct_sbav_pft <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co">#Table in Excel.</span></span>
<span id="cb306-86"><a href="#cb306-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result matrix</span></span>
<span id="cb306-87"><a href="#cb306-87" aria-hidden="true" tabindex="-1"></a>ct_sbav_pft <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb306-88"><a href="#cb306-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix); <span class="fu">rm</span>(sprop); <span class="fu">rm</span>(array); <span class="fu">rm</span>(height); </span>
<span id="cb306-89"><a href="#cb306-89" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(elcprc); <span class="fu">rm</span>(price); <span class="fu">rm</span>(yldvar); <span class="fu">rm</span>(al_regs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_sbav_pft),</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#col.names = TRUE,</span></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_sbav_pft.csv"</span>)</span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_sbav_pft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
</div>
</section>
<section id="sbav_profit-heatmap" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sbav_profit-heatmap"><span class="header-section-number">4.3</span> sbav_profit Heatmap</h2>
<ul>
<li>Heatmap of 648*15 dimension matrix.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_sbav_pft[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 148718</code></pre>
</div>
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_sbav_pft),</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb311-9"><a href="#cb311-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb311-10"><a href="#cb311-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb311-11"><a href="#cb311-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb311-12"><a href="#cb311-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb311-13"><a href="#cb311-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb311-14"><a href="#cb311-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb311-15"><a href="#cb311-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb311-16"><a href="#cb311-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb311-17"><a href="#cb311-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb311-18"><a href="#cb311-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb311-19"><a href="#cb311-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_sbav_pft"</span>, <span class="st">".png"</span>))</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot)</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sbavp_wocp-crosstab" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sbavp_wocp-crosstab"><span class="header-section-number">4.4</span> sbavp_wocp Crosstab</h2>
<ul>
<li><p>Row naming: Electricity Price_Crop Price_Solar Proportion_Alabama Regions</p></li>
<li><p>Column naming: Solar Proportion_Array Types_Solar Panel Height.</p></li>
<li><p>Solar Proportion can be converted to total number of panels.</p></li>
<li><p>Only selected values from each variables are extracted for tabulation purpose.</p></li>
<li><p>Values displayed in the table are profit from Strawberry AV system.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>)</span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>)</span>
<span id="cb313-6"><a href="#cb313-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb313-7"><a href="#cb313-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb313-8"><a href="#cb313-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>)</span>
<span id="cb313-9"><a href="#cb313-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb313-10"><a href="#cb313-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>)</span>
<span id="cb313-11"><a href="#cb313-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-12"><a href="#cb313-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb313-13"><a href="#cb313-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb313-14"><a href="#cb313-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb313-15"><a href="#cb313-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-16"><a href="#cb313-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in sbav_profit</span></span>
<span id="cb313-17"><a href="#cb313-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb313-18"><a href="#cb313-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sbav_profit))</span>
<span id="cb313-19"><a href="#cb313-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb313-20"><a href="#cb313-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sbav_profit: "</span>,</span>
<span id="cb313-21"><a href="#cb313-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb313-22"><a href="#cb313-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb313-23"><a href="#cb313-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-24"><a href="#cb313-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb313-25"><a href="#cb313-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb313-26"><a href="#cb313-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb313-27"><a href="#cb313-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-28"><a href="#cb313-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb313-29"><a href="#cb313-29" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb313-30"><a href="#cb313-30" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb313-31"><a href="#cb313-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb313-32"><a href="#cb313-32" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb313-33"><a href="#cb313-33" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb313-34"><a href="#cb313-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-35"><a href="#cb313-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb313-36"><a href="#cb313-36" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb313-37"><a href="#cb313-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb313-38"><a href="#cb313-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb313-39"><a href="#cb313-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb313-40"><a href="#cb313-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-41"><a href="#cb313-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with</span></span>
<span id="cb313-42"><a href="#cb313-42" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb313-43"><a href="#cb313-43" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb313-44"><a href="#cb313-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb313-45"><a href="#cb313-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb313-46"><a href="#cb313-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb313-47"><a href="#cb313-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb313-48"><a href="#cb313-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb313-49"><a href="#cb313-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb313-50"><a href="#cb313-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-51"><a href="#cb313-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get sbav_profit values for each combination</span></span>
<span id="cb313-52"><a href="#cb313-52" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb313-53"><a href="#cb313-53" aria-hidden="true" tabindex="-1"></a>                     sbav_profit, </span>
<span id="cb313-54"><a href="#cb313-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb313-55"><a href="#cb313-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb313-56"><a href="#cb313-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-57"><a href="#cb313-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb313-58"><a href="#cb313-58" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb313-59"><a href="#cb313-59" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb313-60"><a href="#cb313-60" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb313-61"><a href="#cb313-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>],</span>
<span id="cb313-62"><a href="#cb313-62" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>], </span>
<span id="cb313-63"><a href="#cb313-63" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>]))</span>
<span id="cb313-64"><a href="#cb313-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-65"><a href="#cb313-65" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb313-66"><a href="#cb313-66" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb313-67"><a href="#cb313-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb313-68"><a href="#cb313-68" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb313-69"><a href="#cb313-69" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb313-70"><a href="#cb313-70" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb313-71"><a href="#cb313-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-72"><a href="#cb313-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with sbav_profit values</span></span>
<span id="cb313-73"><a href="#cb313-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb313-74"><a href="#cb313-74" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb313-75"><a href="#cb313-75" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb313-76"><a href="#cb313-76" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb313-77"><a href="#cb313-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb313-78"><a href="#cb313-78" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb313-79"><a href="#cb313-79" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb313-80"><a href="#cb313-80" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb313-81"><a href="#cb313-81" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>sbavp_wocp, <span class="dv">2</span>)</span>
<span id="cb313-82"><a href="#cb313-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb313-83"><a href="#cb313-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb313-84"><a href="#cb313-84" aria-hidden="true" tabindex="-1"></a>ct_sbavp_wocp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co">#Table in Excel.</span></span>
<span id="cb313-85"><a href="#cb313-85" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_sbavp_wocp),</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#col.names = TRUE,</span></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_sbavp_wocp.csv"</span>)</span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_sbavp_wocp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
</div>
</section>
<section id="sbavp_wocp-heatmap" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sbavp_wocp-heatmap"><span class="header-section-number">4.5</span> sbavp_wocp Heatmap</h2>
<ul>
<li>Heatmap of 324*30 dimension matrix.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_sbavp_wocp[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 142167</code></pre>
</div>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_sbavp_wocp),</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb318-10"><a href="#cb318-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb318-11"><a href="#cb318-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb318-12"><a href="#cb318-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb318-13"><a href="#cb318-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb318-14"><a href="#cb318-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb318-15"><a href="#cb318-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb318-16"><a href="#cb318-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb318-17"><a href="#cb318-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb318-18"><a href="#cb318-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb318-19"><a href="#cb318-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_sbavp_wocp"</span>, <span class="st">".png"</span>))</span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot)</span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sbav_be_yld-crosstab" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="sbav_be_yld-crosstab"><span class="header-section-number">4.6</span> sbav_be_yld Crosstab</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>) <span class="co"># Solar Array</span></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>) <span class="co"># Panel height</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>) <span class="co"># Regions of AL</span></span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>) <span class="co"># Electricity Price</span></span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-16"><a href="#cb320-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in sbav_profit</span></span>
<span id="cb320-17"><a href="#cb320-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb320-18"><a href="#cb320-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sbav_be_yld))</span>
<span id="cb320-19"><a href="#cb320-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb320-20"><a href="#cb320-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sbav_be_yld: "</span>,</span>
<span id="cb320-21"><a href="#cb320-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb320-22"><a href="#cb320-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb320-23"><a href="#cb320-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-24"><a href="#cb320-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb320-25"><a href="#cb320-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb320-26"><a href="#cb320-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb320-27"><a href="#cb320-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-28"><a href="#cb320-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb320-29"><a href="#cb320-29" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb320-30"><a href="#cb320-30" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb320-31"><a href="#cb320-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb320-32"><a href="#cb320-32" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb320-33"><a href="#cb320-33" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb320-34"><a href="#cb320-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-35"><a href="#cb320-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb320-36"><a href="#cb320-36" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb320-37"><a href="#cb320-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb320-38"><a href="#cb320-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb320-39"><a href="#cb320-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb320-40"><a href="#cb320-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-41"><a href="#cb320-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb320-42"><a href="#cb320-42" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb320-43"><a href="#cb320-43" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb320-44"><a href="#cb320-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb320-45"><a href="#cb320-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb320-46"><a href="#cb320-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb320-47"><a href="#cb320-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb320-48"><a href="#cb320-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb320-49"><a href="#cb320-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb320-50"><a href="#cb320-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-51"><a href="#cb320-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tavp_be_yld to get tavp_be_yld values for each combination</span></span>
<span id="cb320-52"><a href="#cb320-52" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb320-53"><a href="#cb320-53" aria-hidden="true" tabindex="-1"></a>                     sbav_be_yld, </span>
<span id="cb320-54"><a href="#cb320-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb320-55"><a href="#cb320-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb320-56"><a href="#cb320-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-57"><a href="#cb320-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb320-58"><a href="#cb320-58" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb320-59"><a href="#cb320-59" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb320-60"><a href="#cb320-60" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb320-61"><a href="#cb320-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>]))</span>
<span id="cb320-62"><a href="#cb320-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-63"><a href="#cb320-63" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb320-64"><a href="#cb320-64" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb320-65"><a href="#cb320-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb320-66"><a href="#cb320-66" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb320-67"><a href="#cb320-67" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb320-68"><a href="#cb320-68" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb320-69"><a href="#cb320-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-70"><a href="#cb320-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with sbav_profit values</span></span>
<span id="cb320-71"><a href="#cb320-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb320-72"><a href="#cb320-72" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb320-73"><a href="#cb320-73" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb320-74"><a href="#cb320-74" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb320-75"><a href="#cb320-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb320-76"><a href="#cb320-76" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb320-77"><a href="#cb320-77" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb320-78"><a href="#cb320-78" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb320-79"><a href="#cb320-79" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>yield, <span class="dv">2</span>)</span>
<span id="cb320-80"><a href="#cb320-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb320-81"><a href="#cb320-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb320-82"><a href="#cb320-82" aria-hidden="true" tabindex="-1"></a>ct_sbav_be_yld <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb320-83"><a href="#cb320-83" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_sbav_be_yld),</span>
<span id="cb320-84"><a href="#cb320-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb320-85"><a href="#cb320-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_sbav_be_yld.csv"</span>)</span>
<span id="cb320-86"><a href="#cb320-86" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_sbav_be_yld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
</div>
</section>
<section id="sbav_be_yld-heatmap" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="sbav_be_yld-heatmap"><span class="header-section-number">4.7</span> sbav_be_yld Heatmap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_sbav_be_yld[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_sbav_be_yld),</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb324-8"><a href="#cb324-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb324-9"><a href="#cb324-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb324-10"><a href="#cb324-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb324-11"><a href="#cb324-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb324-12"><a href="#cb324-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb324-13"><a href="#cb324-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb324-14"><a href="#cb324-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb324-15"><a href="#cb324-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb324-16"><a href="#cb324-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb324-17"><a href="#cb324-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb324-18"><a href="#cb324-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb324-19"><a href="#cb324-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_sbav_be_yld"</span>, <span class="st">".png"</span>))</span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot); <span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-strawberry-profit-by-panels" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="plotting-strawberry-profit-by-panels"><span class="header-section-number">4.8</span> Plotting Strawberry Profit by Panels</h2>
<p>You can see plot breakdown based on yield variation, crop price, and electricity price. You can see variation for all solar proportion in one facet of the chart. Each facet of the chart contain av profit three heights of solar panels, four regions of AL, two array types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">yldvar =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.20</span>, <span class="fl">1.5</span>, <span class="fl">1.80</span>, <span class="dv">2</span>), <span class="co"># Yield variation</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>), <span class="co"># Strawberry price</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">elcprc =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>) <span class="co"># Electricity price</span></span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the combinations and create the plots</span></span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (combo <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(combinations))) {</span>
<span id="cb326-9"><a href="#cb326-9" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> sbav_profit <span class="sc">%&gt;%</span></span>
<span id="cb326-10"><a href="#cb326-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb326-11"><a href="#cb326-11" aria-hidden="true" tabindex="-1"></a>      yldvar <span class="sc">==</span> combinations<span class="sc">$</span>yldvar[combo],</span>
<span id="cb326-12"><a href="#cb326-12" aria-hidden="true" tabindex="-1"></a>      price <span class="sc">==</span> combinations<span class="sc">$</span>price[combo],</span>
<span id="cb326-13"><a href="#cb326-13" aria-hidden="true" tabindex="-1"></a>      elcprc <span class="sc">==</span> combinations<span class="sc">$</span>elcprc[combo]</span>
<span id="cb326-14"><a href="#cb326-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb326-15"><a href="#cb326-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If by panel, put panels below in color and group.</span></span>
<span id="cb326-16"><a href="#cb326-16" aria-hidden="true" tabindex="-1"></a>  sbav_sp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> filtered_data,</span>
<span id="cb326-17"><a href="#cb326-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> al_regs,</span>
<span id="cb326-18"><a href="#cb326-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> sbav_profit,</span>
<span id="cb326-19"><a href="#cb326-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> <span class="fu">factor</span>(panels),</span>
<span id="cb326-20"><a href="#cb326-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">group =</span> <span class="fu">factor</span>(panels))) <span class="sc">+</span></span>
<span id="cb326-21"><a href="#cb326-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb326-22"><a href="#cb326-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb326-23"><a href="#cb326-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(height <span class="sc">~</span> array,</span>
<span id="cb326-24"><a href="#cb326-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb326-25"><a href="#cb326-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(</span>
<span id="cb326-26"><a href="#cb326-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4.6"</span> <span class="ot">=</span> <span class="st">"4.6 ft. Height"</span>,</span>
<span id="cb326-27"><a href="#cb326-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6.4"</span> <span class="ot">=</span> <span class="st">"6.4 ft. Height"</span>,</span>
<span id="cb326-28"><a href="#cb326-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8.2"</span> <span class="ot">=</span> <span class="st">"8.2 ft. Height"</span>,</span>
<span id="cb326-29"><a href="#cb326-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tracking =</span> <span class="st">"Single Axis Rotation"</span>, </span>
<span id="cb326-30"><a href="#cb326-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Fixed =</span> <span class="st">"Fixed Open Rack"</span></span>
<span id="cb326-31"><a href="#cb326-31" aria-hidden="true" tabindex="-1"></a>                   ))) <span class="sc">+</span></span>
<span id="cb326-32"><a href="#cb326-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb326-33"><a href="#cb326-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb326-34"><a href="#cb326-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>,</span>
<span id="cb326-35"><a href="#cb326-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>), </span>
<span id="cb326-36"><a href="#cb326-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"Center"</span>, </span>
<span id="cb326-37"><a href="#cb326-37" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"B Belt"</span>, <span class="st">"South"</span>)) <span class="sc">+</span></span>
<span id="cb326-38"><a href="#cb326-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb326-39"><a href="#cb326-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb326-40"><a href="#cb326-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Regions of Alabama"</span>,</span>
<span id="cb326-41"><a href="#cb326-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Profit ($) from Strawberry Agrivoltaic System"</span>,</span>
<span id="cb326-42"><a href="#cb326-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Number of Solar </span><span class="sc">\n</span><span class="st"> Panels per Acre"</span>,</span>
<span id="cb326-43"><a href="#cb326-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> (<span class="fu">list</span>(combinations[combo,]))</span>
<span id="cb326-44"><a href="#cb326-44" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb326-45"><a href="#cb326-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb326-46"><a href="#cb326-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add horizontal line at y = 0 if y has both positive and negative values</span></span>
<span id="cb326-47"><a href="#cb326-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(filtered_data<span class="sc">$</span>sbav_profit) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb326-48"><a href="#cb326-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(filtered_data<span class="sc">$</span>sbav_profit) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb326-49"><a href="#cb326-49" aria-hidden="true" tabindex="-1"></a>    sbav_sp_plot <span class="ot">&lt;-</span> sbav_sp_plot <span class="sc">+</span> </span>
<span id="cb326-50"><a href="#cb326-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb326-51"><a href="#cb326-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.30</span>, </span>
<span id="cb326-52"><a href="#cb326-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb326-53"><a href="#cb326-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb326-54"><a href="#cb326-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb326-55"><a href="#cb326-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combinations[combo,])</span>
<span id="cb326-56"><a href="#cb326-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sbav_sp_plot)</span>
<span id="cb326-57"><a href="#cb326-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/sbav_sp_"</span>, combo, <span class="st">".png"</span>))</span>
<span id="cb326-58"><a href="#cb326-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#break</span></span>
<span id="cb326-59"><a href="#cb326-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
1    0.1     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
2    0.3     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
3    0.5     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
4    0.7     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
5      1     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
6    1.2     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
7    1.5     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
8    1.8     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
9      2     3   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
10    0.1     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
11    0.3     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
12    0.5     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
13    0.7     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
14      1     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
15    1.2     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
16    1.5     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
17    1.8     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
18      2     6   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
19    0.1     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
20    0.3     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
21    0.5     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
22    0.7     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
23      1     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
24    1.2     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
25    1.5     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
26    1.8     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
27      2     9   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
28    0.1     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
29    0.3     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
30    0.5     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
31    0.7     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
32      1     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
33    1.2     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
34    1.5     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
35    1.8     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
36      2     3   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
37    0.1     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
38    0.3     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
39    0.5     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
40    0.7     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
41      1     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
42    1.2     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
43    1.5     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
44    1.8     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
45      2     6   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-45.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
46    0.1     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-46.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
47    0.3     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-47.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
48    0.5     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-48.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
49    0.7     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-49.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
50      1     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-50.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
51    1.2     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-51.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
52    1.5     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-52.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
53    1.8     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-53.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
54      2     9   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-54.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
55    0.1     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-55.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
56    0.3     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-56.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
57    0.5     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-57.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
58    0.7     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-58.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
59      1     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-59.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
60    1.2     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-60.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
61    1.5     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-61.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
62    1.8     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-62.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
63      2     3   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-63.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
64    0.1     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-64.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
65    0.3     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-65.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
66    0.5     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-66.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
67    0.7     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-67.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
68      1     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-68.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
69    1.2     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-69.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
70    1.5     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-70.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
71    1.8     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-71.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
72      2     6   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-72.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
73    0.1     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-73.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
74    0.3     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-74.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
75    0.5     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-75.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
76    0.7     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-76.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
77      1     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-77.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
78    1.2     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-78.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
79    1.5     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-79.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
80    1.8     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-80.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
81      2     9   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-44-81.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-strawberry-profit-by-yields" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="plotting-strawberry-profit-by-yields"><span class="header-section-number">4.9</span> Plotting Strawberry Profit by Yields</h2>
<p>You can see plot breakdown based on solar proportion, crop price, and electricity price. You can see variation for all crop yield variation in one facet of the chart. Each facet of the chart contain av profit three heights of solar panels, four regions of AL, two array types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb489"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sprop =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.00</span>), <span class="co"># Solar proportion</span></span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>), <span class="co"># Strawberry price</span></span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">elcprc =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>) <span class="co">#Electricity price</span></span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb489-6"><a href="#cb489-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-7"><a href="#cb489-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the combinations and create the plots</span></span>
<span id="cb489-8"><a href="#cb489-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (combo <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(combinations))) {</span>
<span id="cb489-9"><a href="#cb489-9" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> sbav_profit <span class="sc">%&gt;%</span></span>
<span id="cb489-10"><a href="#cb489-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb489-11"><a href="#cb489-11" aria-hidden="true" tabindex="-1"></a>      sprop <span class="sc">==</span> combinations<span class="sc">$</span>sprop[combo],</span>
<span id="cb489-12"><a href="#cb489-12" aria-hidden="true" tabindex="-1"></a>      price <span class="sc">==</span> combinations<span class="sc">$</span>price[combo],</span>
<span id="cb489-13"><a href="#cb489-13" aria-hidden="true" tabindex="-1"></a>      elcprc <span class="sc">==</span> combinations<span class="sc">$</span>elcprc[combo]</span>
<span id="cb489-14"><a href="#cb489-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb489-15"><a href="#cb489-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If by yield, put yield below in color and group.</span></span>
<span id="cb489-16"><a href="#cb489-16" aria-hidden="true" tabindex="-1"></a>  sbav_yv_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> filtered_data,</span>
<span id="cb489-17"><a href="#cb489-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> al_regs,</span>
<span id="cb489-18"><a href="#cb489-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> sbav_profit,</span>
<span id="cb489-19"><a href="#cb489-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> <span class="fu">factor</span>(yield),</span>
<span id="cb489-20"><a href="#cb489-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">group =</span> <span class="fu">factor</span>(yield))) <span class="sc">+</span></span>
<span id="cb489-21"><a href="#cb489-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb489-22"><a href="#cb489-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb489-23"><a href="#cb489-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(height <span class="sc">~</span> array,</span>
<span id="cb489-24"><a href="#cb489-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb489-25"><a href="#cb489-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(</span>
<span id="cb489-26"><a href="#cb489-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4.6"</span> <span class="ot">=</span> <span class="st">"4.6 ft. Height"</span>,</span>
<span id="cb489-27"><a href="#cb489-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6.4"</span> <span class="ot">=</span> <span class="st">"6.4 ft. Height"</span>,</span>
<span id="cb489-28"><a href="#cb489-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8.2"</span> <span class="ot">=</span> <span class="st">"8.2 ft. Height"</span>,</span>
<span id="cb489-29"><a href="#cb489-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tracking =</span> <span class="st">"Single Axis Rotation"</span>, </span>
<span id="cb489-30"><a href="#cb489-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Fixed =</span> <span class="st">"Fixed Open Rack"</span></span>
<span id="cb489-31"><a href="#cb489-31" aria-hidden="true" tabindex="-1"></a>                   ))) <span class="sc">+</span></span>
<span id="cb489-32"><a href="#cb489-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb489-33"><a href="#cb489-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb489-34"><a href="#cb489-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>,</span>
<span id="cb489-35"><a href="#cb489-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>), </span>
<span id="cb489-36"><a href="#cb489-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"Center"</span>, </span>
<span id="cb489-37"><a href="#cb489-37" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"B Belt"</span>, <span class="st">"South"</span>)) <span class="sc">+</span></span>
<span id="cb489-38"><a href="#cb489-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb489-39"><a href="#cb489-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb489-40"><a href="#cb489-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Regions of Alabama"</span>,</span>
<span id="cb489-41"><a href="#cb489-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Profit ($) from Strawberry Agrivoltaic System"</span>,</span>
<span id="cb489-42"><a href="#cb489-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Strawberry Yield </span><span class="sc">\n</span><span class="st"> (25 Lb Buckets)"</span>,</span>
<span id="cb489-43"><a href="#cb489-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> (<span class="fu">list</span>(combinations[combo,]))</span>
<span id="cb489-44"><a href="#cb489-44" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb489-45"><a href="#cb489-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb489-46"><a href="#cb489-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add horizontal line at y = 0 if y has both positive and negative values</span></span>
<span id="cb489-47"><a href="#cb489-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(filtered_data<span class="sc">$</span>sbav_profit) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb489-48"><a href="#cb489-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(filtered_data<span class="sc">$</span>sbav_profit) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb489-49"><a href="#cb489-49" aria-hidden="true" tabindex="-1"></a>    sbav_yv_plot <span class="ot">&lt;-</span> sbav_yv_plot <span class="sc">+</span> </span>
<span id="cb489-50"><a href="#cb489-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb489-51"><a href="#cb489-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.30</span>, </span>
<span id="cb489-52"><a href="#cb489-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb489-53"><a href="#cb489-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb489-54"><a href="#cb489-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb489-55"><a href="#cb489-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combinations[combo,])</span>
<span id="cb489-56"><a href="#cb489-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sbav_yv_plot)</span>
<span id="cb489-57"><a href="#cb489-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/sbav_yv_"</span>, combo, <span class="st">".png"</span>))</span>
<span id="cb489-58"><a href="#cb489-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#break</span></span>
<span id="cb489-59"><a href="#cb489-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="squash-av-results" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Squash AV Results</h1>
<section id="sqav_profit-crosstab-64815" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sqav_profit-crosstab-64815"><span class="header-section-number">5.1</span> sqav_profit Crosstab (648*15)</h2>
<ul>
<li><p>Row naming: Electricity Price_Crop Price_Solar Proportion_Alabama Regions</p></li>
<li><p>Column naming: Solar Proportion_Array Types_Solar Panel Height.</p></li>
<li><p>Solar Proportion can be converted to total number of panels.</p></li>
<li><p>Only selected values from each variables are extracted for tabulation purpose.</p></li>
<li><p>Values displayed in the table are profit from Squash AV system.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>)</span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>)</span>
<span id="cb490-6"><a href="#cb490-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb490-7"><a href="#cb490-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb490-8"><a href="#cb490-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>)</span>
<span id="cb490-9"><a href="#cb490-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>)</span>
<span id="cb490-10"><a href="#cb490-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>)</span>
<span id="cb490-11"><a href="#cb490-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-12"><a href="#cb490-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb490-13"><a href="#cb490-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, <span class="st">"al_regs"</span>, </span>
<span id="cb490-14"><a href="#cb490-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb490-15"><a href="#cb490-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-16"><a href="#cb490-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb490-17"><a href="#cb490-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb490-18"><a href="#cb490-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sqav_profit))</span>
<span id="cb490-19"><a href="#cb490-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb490-20"><a href="#cb490-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sqav_profit: "</span>, </span>
<span id="cb490-21"><a href="#cb490-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns,</span>
<span id="cb490-22"><a href="#cb490-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb490-23"><a href="#cb490-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb490-24"><a href="#cb490-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-25"><a href="#cb490-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using expand.grid without array</span></span>
<span id="cb490-26"><a href="#cb490-26" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, sprop), </span>
<span id="cb490-27"><a href="#cb490-27" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>, <span class="cf">function</span>(x) </span>
<span id="cb490-28"><a href="#cb490-28" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">paste0</span>(x[<span class="dv">2</span>], <span class="st">"%_"</span>,</span>
<span id="cb490-29"><a href="#cb490-29" aria-hidden="true" tabindex="-1"></a>                            x[<span class="dv">1</span>]))</span>
<span id="cb490-30"><a href="#cb490-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-31"><a href="#cb490-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using expand.grid with array included</span></span>
<span id="cb490-32"><a href="#cb490-32" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, price, yldvar, al_regs, array),</span>
<span id="cb490-33"><a href="#cb490-33" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>], <span class="st">"_"</span>, </span>
<span id="cb490-34"><a href="#cb490-34" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">3</span>], <span class="st">"_"</span>, </span>
<span id="cb490-35"><a href="#cb490-35" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">2</span>], <span class="st">"_"</span>,</span>
<span id="cb490-36"><a href="#cb490-36" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">1</span>], <span class="st">"_"</span>, </span>
<span id="cb490-37"><a href="#cb490-37" aria-hidden="true" tabindex="-1"></a>                                         x[<span class="dv">5</span>]))</span>
<span id="cb490-38"><a href="#cb490-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-39"><a href="#cb490-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb490-40"><a href="#cb490-40" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, </span>
<span id="cb490-41"><a href="#cb490-41" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb490-42"><a href="#cb490-42" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb490-43"><a href="#cb490-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb490-44"><a href="#cb490-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb490-45"><a href="#cb490-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-46"><a href="#cb490-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with all combinations of parameters</span></span>
<span id="cb490-47"><a href="#cb490-47" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb490-48"><a href="#cb490-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb490-49"><a href="#cb490-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb490-50"><a href="#cb490-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb490-51"><a href="#cb490-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb490-52"><a href="#cb490-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb490-53"><a href="#cb490-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb490-54"><a href="#cb490-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-55"><a href="#cb490-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get av_profit values for each combination</span></span>
<span id="cb490-56"><a href="#cb490-56" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb490-57"><a href="#cb490-57" aria-hidden="true" tabindex="-1"></a>                     sqav_profit, </span>
<span id="cb490-58"><a href="#cb490-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>,</span>
<span id="cb490-59"><a href="#cb490-59" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>,</span>
<span id="cb490-60"><a href="#cb490-60" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"elcprc"</span>),</span>
<span id="cb490-61"><a href="#cb490-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb490-62"><a href="#cb490-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-63"><a href="#cb490-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with adjusted column and row names</span></span>
<span id="cb490-64"><a href="#cb490-64" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"height"</span>)],</span>
<span id="cb490-65"><a href="#cb490-65" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], <span class="st">"%_"</span>,</span>
<span id="cb490-66"><a href="#cb490-66" aria-hidden="true" tabindex="-1"></a>                                                    x[<span class="dv">2</span>]))</span>
<span id="cb490-67"><a href="#cb490-67" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>,</span>
<span id="cb490-68"><a href="#cb490-68" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"elcprc"</span>, <span class="st">"array"</span>)], <span class="dv">1</span>,</span>
<span id="cb490-69"><a href="#cb490-69" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], <span class="st">"_"</span>,</span>
<span id="cb490-70"><a href="#cb490-70" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">2</span>], <span class="st">"_"</span>,</span>
<span id="cb490-71"><a href="#cb490-71" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">3</span>], <span class="st">"_"</span>,</span>
<span id="cb490-72"><a href="#cb490-72" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">4</span>], <span class="st">"_"</span>,</span>
<span id="cb490-73"><a href="#cb490-73" aria-hidden="true" tabindex="-1"></a>                                                 x[<span class="dv">5</span>]))</span>
<span id="cb490-74"><a href="#cb490-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-75"><a href="#cb490-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with av_profit values</span></span>
<span id="cb490-76"><a href="#cb490-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb490-77"><a href="#cb490-77" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb490-78"><a href="#cb490-78" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb490-79"><a href="#cb490-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb490-80"><a href="#cb490-80" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, <span class="fu">match</span>(</span>
<span id="cb490-81"><a href="#cb490-81" aria-hidden="true" tabindex="-1"></a>      row_data<span class="sc">$</span>col_name,</span>
<span id="cb490-82"><a href="#cb490-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(row_data<span class="sc">$</span>sqav_profit, <span class="dv">2</span>)</span>
<span id="cb490-83"><a href="#cb490-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb490-84"><a href="#cb490-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb490-85"><a href="#cb490-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-86"><a href="#cb490-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result matrix</span></span>
<span id="cb490-87"><a href="#cb490-87" aria-hidden="true" tabindex="-1"></a>ct_sqav_pft64815 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb490-88"><a href="#cb490-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sqav_profit-crosstab-32430" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="sqav_profit-crosstab-32430"><span class="header-section-number">5.2</span> sqav_profit Crosstab (324*30)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shape crosstab.</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>)</span>
<span id="cb491-6"><a href="#cb491-6" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>)</span>
<span id="cb491-7"><a href="#cb491-7" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb491-8"><a href="#cb491-8" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb491-9"><a href="#cb491-9" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>)</span>
<span id="cb491-10"><a href="#cb491-10" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>)</span>
<span id="cb491-11"><a href="#cb491-11" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>)</span>
<span id="cb491-12"><a href="#cb491-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-13"><a href="#cb491-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb491-14"><a href="#cb491-14" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb491-15"><a href="#cb491-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb491-16"><a href="#cb491-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-17"><a href="#cb491-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in sqav_profit</span></span>
<span id="cb491-18"><a href="#cb491-18" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb491-19"><a href="#cb491-19" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sqav_profit))</span>
<span id="cb491-20"><a href="#cb491-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb491-21"><a href="#cb491-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sqav_profit: "</span>,</span>
<span id="cb491-22"><a href="#cb491-22" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb491-23"><a href="#cb491-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb491-24"><a href="#cb491-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-25"><a href="#cb491-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb491-26"><a href="#cb491-26" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb491-27"><a href="#cb491-27" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>],</span>
<span id="cb491-28"><a href="#cb491-28" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">2</span>],</span>
<span id="cb491-29"><a href="#cb491-29" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">1</span>]))</span>
<span id="cb491-30"><a href="#cb491-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-31"><a href="#cb491-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb491-32"><a href="#cb491-32" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb491-33"><a href="#cb491-33" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb491-34"><a href="#cb491-34" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb491-35"><a href="#cb491-35" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb491-36"><a href="#cb491-36" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb491-37"><a href="#cb491-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-38"><a href="#cb491-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb491-39"><a href="#cb491-39" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb491-40"><a href="#cb491-40" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb491-41"><a href="#cb491-41" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb491-42"><a href="#cb491-42" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb491-43"><a href="#cb491-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-44"><a href="#cb491-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb491-45"><a href="#cb491-45" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb491-46"><a href="#cb491-46" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb491-47"><a href="#cb491-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb491-48"><a href="#cb491-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb491-49"><a href="#cb491-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb491-50"><a href="#cb491-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb491-51"><a href="#cb491-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb491-52"><a href="#cb491-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb491-53"><a href="#cb491-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-54"><a href="#cb491-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get sqav_profit values for each combination</span></span>
<span id="cb491-55"><a href="#cb491-55" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb491-56"><a href="#cb491-56" aria-hidden="true" tabindex="-1"></a>                     sqav_profit, </span>
<span id="cb491-57"><a href="#cb491-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb491-58"><a href="#cb491-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb491-59"><a href="#cb491-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-60"><a href="#cb491-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb491-61"><a href="#cb491-61" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb491-62"><a href="#cb491-62" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb491-63"><a href="#cb491-63" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb491-64"><a href="#cb491-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>],</span>
<span id="cb491-65"><a href="#cb491-65" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb491-66"><a href="#cb491-66" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>]))</span>
<span id="cb491-67"><a href="#cb491-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-68"><a href="#cb491-68" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb491-69"><a href="#cb491-69" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb491-70"><a href="#cb491-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb491-71"><a href="#cb491-71" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb491-72"><a href="#cb491-72" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb491-73"><a href="#cb491-73" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb491-74"><a href="#cb491-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-75"><a href="#cb491-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with sqav_profit values</span></span>
<span id="cb491-76"><a href="#cb491-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb491-77"><a href="#cb491-77" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb491-78"><a href="#cb491-78" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb491-79"><a href="#cb491-79" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb491-80"><a href="#cb491-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb491-81"><a href="#cb491-81" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb491-82"><a href="#cb491-82" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb491-83"><a href="#cb491-83" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb491-84"><a href="#cb491-84" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>sqav_profit, <span class="dv">2</span>)</span>
<span id="cb491-85"><a href="#cb491-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb491-86"><a href="#cb491-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb491-87"><a href="#cb491-87" aria-hidden="true" tabindex="-1"></a>ct_sqav_pft <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb491-88"><a href="#cb491-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix); <span class="fu">rm</span>(sprop); <span class="fu">rm</span>(array); <span class="fu">rm</span>(height); </span>
<span id="cb491-89"><a href="#cb491-89" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(elcprc); <span class="fu">rm</span>(price); <span class="fu">rm</span>(yldvar); <span class="fu">rm</span>(al_regs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb492"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_sqav_pft),</span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_sqav_pft.csv"</span>)</span>
<span id="cb492-4"><a href="#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_sqav_pft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
</div>
</section>
<section id="sqav_profit-heatmap" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="sqav_profit-heatmap"><span class="header-section-number">5.3</span> sqav_profit Heatmap</h2>
<ul>
<li>Heatmap of 648*15 dimension matrix.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_sqav_pft[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 147737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_sqav_pft),</span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb496-8"><a href="#cb496-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb496-9"><a href="#cb496-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb496-10"><a href="#cb496-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb496-11"><a href="#cb496-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb496-12"><a href="#cb496-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb496-13"><a href="#cb496-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb496-14"><a href="#cb496-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb496-15"><a href="#cb496-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb496-16"><a href="#cb496-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb496-17"><a href="#cb496-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb496-18"><a href="#cb496-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb496-19"><a href="#cb496-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_sqav_pft"</span>, <span class="st">".png"</span>))</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot)</span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sqavp_wocp-crosstab" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="sqavp_wocp-crosstab"><span class="header-section-number">5.4</span> sqavp_wocp Crosstab</h2>
<ul>
<li><p>Profit at 100% crop at their respective price is subtracted from tav_profit.</p></li>
<li><p>tavp_wocp = tav_profit - profit from 100% crop at their respective prices. This variable gives an idea where av profit stands in relation to crop profit. It helps to identify relative profitability of agrivoltaic system compared to crop only.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>)</span>
<span id="cb498-5"><a href="#cb498-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>)</span>
<span id="cb498-6"><a href="#cb498-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb498-7"><a href="#cb498-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>)</span>
<span id="cb498-8"><a href="#cb498-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>)</span>
<span id="cb498-9"><a href="#cb498-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>)</span>
<span id="cb498-10"><a href="#cb498-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>)</span>
<span id="cb498-11"><a href="#cb498-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-12"><a href="#cb498-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb498-13"><a href="#cb498-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb498-14"><a href="#cb498-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb498-15"><a href="#cb498-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-16"><a href="#cb498-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in sqav_profit</span></span>
<span id="cb498-17"><a href="#cb498-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb498-18"><a href="#cb498-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sqav_profit))</span>
<span id="cb498-19"><a href="#cb498-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb498-20"><a href="#cb498-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sqav_profit: "</span>,</span>
<span id="cb498-21"><a href="#cb498-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb498-22"><a href="#cb498-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb498-23"><a href="#cb498-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-24"><a href="#cb498-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb498-25"><a href="#cb498-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb498-26"><a href="#cb498-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>],</span>
<span id="cb498-27"><a href="#cb498-27" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">2</span>],</span>
<span id="cb498-28"><a href="#cb498-28" aria-hidden="true" tabindex="-1"></a>                                      x[<span class="dv">1</span>]))</span>
<span id="cb498-29"><a href="#cb498-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-30"><a href="#cb498-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb498-31"><a href="#cb498-31" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb498-32"><a href="#cb498-32" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb498-33"><a href="#cb498-33" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb498-34"><a href="#cb498-34" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb498-35"><a href="#cb498-35" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb498-36"><a href="#cb498-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-37"><a href="#cb498-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb498-38"><a href="#cb498-38" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb498-39"><a href="#cb498-39" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb498-40"><a href="#cb498-40" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb498-41"><a href="#cb498-41" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb498-42"><a href="#cb498-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-43"><a href="#cb498-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb498-44"><a href="#cb498-44" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb498-45"><a href="#cb498-45" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb498-46"><a href="#cb498-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb498-47"><a href="#cb498-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb498-48"><a href="#cb498-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb498-49"><a href="#cb498-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb498-50"><a href="#cb498-50" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb498-51"><a href="#cb498-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb498-52"><a href="#cb498-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-53"><a href="#cb498-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tav_profit to get sqav_profit values for each combination</span></span>
<span id="cb498-54"><a href="#cb498-54" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb498-55"><a href="#cb498-55" aria-hidden="true" tabindex="-1"></a>                     sqav_profit, </span>
<span id="cb498-56"><a href="#cb498-56" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb498-57"><a href="#cb498-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb498-58"><a href="#cb498-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-59"><a href="#cb498-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb498-60"><a href="#cb498-60" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb498-61"><a href="#cb498-61" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb498-62"><a href="#cb498-62" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb498-63"><a href="#cb498-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>],</span>
<span id="cb498-64"><a href="#cb498-64" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb498-65"><a href="#cb498-65" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>]))</span>
<span id="cb498-66"><a href="#cb498-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-67"><a href="#cb498-67" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb498-68"><a href="#cb498-68" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb498-69"><a href="#cb498-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb498-70"><a href="#cb498-70" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb498-71"><a href="#cb498-71" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb498-72"><a href="#cb498-72" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb498-73"><a href="#cb498-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-74"><a href="#cb498-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with sqav_profit values</span></span>
<span id="cb498-75"><a href="#cb498-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb498-76"><a href="#cb498-76" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb498-77"><a href="#cb498-77" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb498-78"><a href="#cb498-78" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb498-79"><a href="#cb498-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb498-80"><a href="#cb498-80" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb498-81"><a href="#cb498-81" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb498-82"><a href="#cb498-82" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb498-83"><a href="#cb498-83" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>sqavp_wocp, <span class="dv">2</span>)</span>
<span id="cb498-84"><a href="#cb498-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb498-85"><a href="#cb498-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb498-86"><a href="#cb498-86" aria-hidden="true" tabindex="-1"></a>ct_sqavp_wocp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co">#Table in Excel.</span></span>
<span id="cb498-87"><a href="#cb498-87" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb499"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_sqavp_wocp),</span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_sqavp_wocp.csv"</span>)</span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_sqavp_wocp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
</div>
</section>
<section id="sqavp_wocp-heatmap" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="sqavp_wocp-heatmap"><span class="header-section-number">5.5</span> sqavp_wocp Heatmap</h2>
<ul>
<li>Heatmap of 324*30 dimension matrix.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb501"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_sqavp_wocp[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 141176</code></pre>
</div>
<div class="sourceCode cell-code" id="cb503"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_sqavp_wocp),</span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb503-3"><a href="#cb503-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb503-4"><a href="#cb503-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb503-5"><a href="#cb503-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb503-6"><a href="#cb503-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb503-7"><a href="#cb503-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb503-8"><a href="#cb503-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb503-9"><a href="#cb503-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb503-10"><a href="#cb503-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb503-11"><a href="#cb503-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb503-12"><a href="#cb503-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb503-13"><a href="#cb503-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb503-14"><a href="#cb503-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb503-15"><a href="#cb503-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb503-16"><a href="#cb503-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb503-17"><a href="#cb503-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb503-18"><a href="#cb503-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb503-19"><a href="#cb503-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb504-4"><a href="#cb504-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb504-5"><a href="#cb504-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_sqavp_wocp"</span>, <span class="st">".png"</span>))</span>
<span id="cb504-6"><a href="#cb504-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot)</span>
<span id="cb504-7"><a href="#cb504-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sqavp_be_yld-crosstab" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="sqavp_be_yld-crosstab"><span class="header-section-number">5.6</span> sqavp_be_yld Crosstab</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the values for each variable</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>sprop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.25</span>, <span class="fl">0.30</span>, <span class="fl">0.35</span>, <span class="fl">0.40</span>, <span class="fl">0.45</span>, <span class="fl">0.50</span>,</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.55</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>, <span class="fl">0.70</span>, <span class="fl">0.75</span>, <span class="fl">0.80</span>, <span class="fl">0.85</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">1.00</span>) <span class="co"># Land Proportion</span></span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a>array <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Tracking"</span>) <span class="co"># Solar Array</span></span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">6.4</span>, <span class="fl">8.2</span>) <span class="co"># Panel height</span></span>
<span id="cb505-6"><a href="#cb505-6" aria-hidden="true" tabindex="-1"></a>yldvar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.50</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span>, </span>
<span id="cb505-7"><a href="#cb505-7" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.10</span>, <span class="fl">1.20</span>, <span class="fl">1.30</span>, <span class="fl">1.40</span>, <span class="fl">1.50</span>, <span class="fl">1.60</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.90</span>, <span class="fl">2.00</span>) <span class="co"># Crop Yield Variation</span></span>
<span id="cb505-8"><a href="#cb505-8" aria-hidden="true" tabindex="-1"></a>al_regs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>, <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>) <span class="co"># Regions of AL</span></span>
<span id="cb505-9"><a href="#cb505-9" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>)</span>
<span id="cb505-10"><a href="#cb505-10" aria-hidden="true" tabindex="-1"></a>elcprc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>) <span class="co"># Electricity Price</span></span>
<span id="cb505-11"><a href="#cb505-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-12"><a href="#cb505-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the required columns</span></span>
<span id="cb505-13"><a href="#cb505-13" aria-hidden="true" tabindex="-1"></a>required_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>, </span>
<span id="cb505-14"><a href="#cb505-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)</span>
<span id="cb505-15"><a href="#cb505-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-16"><a href="#cb505-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the columns exist in tav_profit</span></span>
<span id="cb505-17"><a href="#cb505-17" aria-hidden="true" tabindex="-1"></a>missing_columns <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_columns, </span>
<span id="cb505-18"><a href="#cb505-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">names</span>(sqav_be_yld))</span>
<span id="cb505-19"><a href="#cb505-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_columns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb505-20"><a href="#cb505-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing columns in sqavp_be_yld: "</span>,</span>
<span id="cb505-21"><a href="#cb505-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(missing_columns, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb505-22"><a href="#cb505-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb505-23"><a href="#cb505-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-24"><a href="#cb505-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate column names using reversed order of expand.grid</span></span>
<span id="cb505-25"><a href="#cb505-25" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(height, array, sprop), <span class="dv">1</span>,</span>
<span id="cb505-26"><a href="#cb505-26" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">3</span>], x[<span class="dv">2</span>], x[<span class="dv">1</span>]))</span>
<span id="cb505-27"><a href="#cb505-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-28"><a href="#cb505-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate row names using reversed order of expand.grid</span></span>
<span id="cb505-29"><a href="#cb505-29" aria-hidden="true" tabindex="-1"></a>row_names <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">expand.grid</span>(elcprc, </span>
<span id="cb505-30"><a href="#cb505-30" aria-hidden="true" tabindex="-1"></a>                               price,</span>
<span id="cb505-31"><a href="#cb505-31" aria-hidden="true" tabindex="-1"></a>                               yldvar, </span>
<span id="cb505-32"><a href="#cb505-32" aria-hidden="true" tabindex="-1"></a>                               al_regs), <span class="dv">1</span>, </span>
<span id="cb505-33"><a href="#cb505-33" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb505-34"><a href="#cb505-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-35"><a href="#cb505-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty matrix to store the results</span></span>
<span id="cb505-36"><a href="#cb505-36" aria-hidden="true" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(row_names), </span>
<span id="cb505-37"><a href="#cb505-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="fu">length</span>(col_names))</span>
<span id="cb505-38"><a href="#cb505-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_matrix) <span class="ot">&lt;-</span> col_names</span>
<span id="cb505-39"><a href="#cb505-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(result_matrix) <span class="ot">&lt;-</span> row_names</span>
<span id="cb505-40"><a href="#cb505-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-41"><a href="#cb505-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with </span></span>
<span id="cb505-42"><a href="#cb505-42" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of parameters in reversed order</span></span>
<span id="cb505-43"><a href="#cb505-43" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">elcprc =</span> elcprc, </span>
<span id="cb505-44"><a href="#cb505-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">price =</span> price, </span>
<span id="cb505-45"><a href="#cb505-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yldvar =</span> yldvar, </span>
<span id="cb505-46"><a href="#cb505-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">al_regs =</span> al_regs,</span>
<span id="cb505-47"><a href="#cb505-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">height =</span> height, </span>
<span id="cb505-48"><a href="#cb505-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">array =</span> array, </span>
<span id="cb505-49"><a href="#cb505-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sprop =</span> sprop)</span>
<span id="cb505-50"><a href="#cb505-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-51"><a href="#cb505-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with tavp_be_yld to get sbav_be_yld values for each combination</span></span>
<span id="cb505-52"><a href="#cb505-52" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(param_combinations, </span>
<span id="cb505-53"><a href="#cb505-53" aria-hidden="true" tabindex="-1"></a>                     sqav_be_yld, </span>
<span id="cb505-54"><a href="#cb505-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> required_columns,</span>
<span id="cb505-55"><a href="#cb505-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb505-56"><a href="#cb505-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-57"><a href="#cb505-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape merged_data to fill result_matrix with </span></span>
<span id="cb505-58"><a href="#cb505-58" aria-hidden="true" tabindex="-1"></a><span class="co"># reversed column and row names</span></span>
<span id="cb505-59"><a href="#cb505-59" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>col_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb505-60"><a href="#cb505-60" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"sprop"</span>, <span class="st">"array"</span>, <span class="st">"height"</span>)], <span class="dv">1</span>,</span>
<span id="cb505-61"><a href="#cb505-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>]))</span>
<span id="cb505-62"><a href="#cb505-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-63"><a href="#cb505-63" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>row_name <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb505-64"><a href="#cb505-64" aria-hidden="true" tabindex="-1"></a>  merged_data[, <span class="fu">c</span>(<span class="st">"al_regs"</span>, <span class="st">"yldvar"</span>, <span class="st">"price"</span>, <span class="st">"elcprc"</span>)], <span class="dv">1</span>,</span>
<span id="cb505-65"><a href="#cb505-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">paste0</span>(x[<span class="dv">4</span>],</span>
<span id="cb505-66"><a href="#cb505-66" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">3</span>],</span>
<span id="cb505-67"><a href="#cb505-67" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">2</span>],</span>
<span id="cb505-68"><a href="#cb505-68" aria-hidden="true" tabindex="-1"></a>                     x[<span class="dv">1</span>]))</span>
<span id="cb505-69"><a href="#cb505-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-70"><a href="#cb505-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the matrix with sbav_profit values</span></span>
<span id="cb505-71"><a href="#cb505-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(result_matrix))) {</span>
<span id="cb505-72"><a href="#cb505-72" aria-hidden="true" tabindex="-1"></a>  row_condition <span class="ot">&lt;-</span> <span class="fu">rownames</span>(result_matrix)[i]</span>
<span id="cb505-73"><a href="#cb505-73" aria-hidden="true" tabindex="-1"></a>  row_data <span class="ot">&lt;-</span> merged_data[</span>
<span id="cb505-74"><a href="#cb505-74" aria-hidden="true" tabindex="-1"></a>    merged_data<span class="sc">$</span>row_name <span class="sc">==</span> row_condition, ]</span>
<span id="cb505-75"><a href="#cb505-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(row_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb505-76"><a href="#cb505-76" aria-hidden="true" tabindex="-1"></a>    result_matrix[i, </span>
<span id="cb505-77"><a href="#cb505-77" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">match</span>(row_data<span class="sc">$</span>col_name, </span>
<span id="cb505-78"><a href="#cb505-78" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">colnames</span>(result_matrix))] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb505-79"><a href="#cb505-79" aria-hidden="true" tabindex="-1"></a>                          row_data<span class="sc">$</span>yield, <span class="dv">2</span>)</span>
<span id="cb505-80"><a href="#cb505-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb505-81"><a href="#cb505-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb505-82"><a href="#cb505-82" aria-hidden="true" tabindex="-1"></a>ct_sqav_be_yld <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(result_matrix) <span class="co"># Table in Excel.</span></span>
<span id="cb505-83"><a href="#cb505-83" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(ct_sqav_be_yld),</span>
<span id="cb505-84"><a href="#cb505-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb505-85"><a href="#cb505-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">"Results/ct_sqav_be_yld.csv"</span>)</span>
<span id="cb505-86"><a href="#cb505-86" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ct_sqav_be_yld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1680  126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(result_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sqavp_be_yld-heatmap" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="sqavp_be_yld-heatmap"><span class="header-section-number">5.7</span> sqavp_be_yld Heatmap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb508"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a>colorcount <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.vector</span>(<span class="fu">as.matrix</span>(ct_sqav_be_yld[<span class="sc">-</span><span class="dv">1</span>]))))</span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a>colorcount</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb510"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a>heatmap_plot <span class="ot">&lt;-</span> <span class="fu">pheatmap</span>(<span class="fu">t</span>(ct_sqav_be_yld),</span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#clustering_distance_rows = "correlation",</span></span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_rows =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb510-4"><a href="#cb510-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb510-5"><a href="#cb510-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clustering_method =</span> <span class="st">"complete"</span>,</span>
<span id="cb510-6"><a href="#cb510-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, </span>
<span id="cb510-7"><a href="#cb510-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"yellow"</span>, </span>
<span id="cb510-8"><a href="#cb510-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"green"</span>))(colorcount),</span>
<span id="cb510-9"><a href="#cb510-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_rows = 5,</span></span>
<span id="cb510-10"><a href="#cb510-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cutree_cols = 4,</span></span>
<span id="cb510-11"><a href="#cb510-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb510-12"><a href="#cb510-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb510-13"><a href="#cb510-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb510-14"><a href="#cb510-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb510-15"><a href="#cb510-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">display_numbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb510-16"><a href="#cb510-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb510-17"><a href="#cb510-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellheight = 3,</span></span>
<span id="cb510-18"><a href="#cb510-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#cellwidth = 3</span></span>
<span id="cb510-19"><a href="#cb510-19" aria-hidden="true" tabindex="-1"></a>                         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb511"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(heatmap_plot,</span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb511-4"><a href="#cb511-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb511-5"><a href="#cb511-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/gp_sqav_be_yld"</span>, <span class="st">".png"</span>))</span>
<span id="cb511-6"><a href="#cb511-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(heatmap_plot)</span>
<span id="cb511-7"><a href="#cb511-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(colorcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-squash-profit-by-panels" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="plotting-squash-profit-by-panels"><span class="header-section-number">5.8</span> Plotting Squash Profit by Panels</h2>
<p>You can see plot breakdown based on yield variation, crop price, and electricity price. You can see variation for all solar proportion in one facet of the chart. Each facet of the chart contain av profit three heights of solar panels, four regions of AL, two array types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">yldvar =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.20</span>, <span class="fl">1.5</span>, <span class="fl">1.80</span>, <span class="dv">2</span>), <span class="co"># Yield variation</span></span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">17</span>), <span class="co"># Squash price</span></span>
<span id="cb512-4"><a href="#cb512-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">elcprc =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>) <span class="co">#Electricity price</span></span>
<span id="cb512-5"><a href="#cb512-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb512-6"><a href="#cb512-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-7"><a href="#cb512-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the combinations and create the plots</span></span>
<span id="cb512-8"><a href="#cb512-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (combo <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(combinations))) {</span>
<span id="cb512-9"><a href="#cb512-9" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> sqav_profit <span class="sc">%&gt;%</span></span>
<span id="cb512-10"><a href="#cb512-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb512-11"><a href="#cb512-11" aria-hidden="true" tabindex="-1"></a>      yldvar <span class="sc">==</span> combinations<span class="sc">$</span>yldvar[combo],</span>
<span id="cb512-12"><a href="#cb512-12" aria-hidden="true" tabindex="-1"></a>      price <span class="sc">==</span> combinations<span class="sc">$</span>price[combo],</span>
<span id="cb512-13"><a href="#cb512-13" aria-hidden="true" tabindex="-1"></a>      elcprc <span class="sc">==</span> combinations<span class="sc">$</span>elcprc[combo]</span>
<span id="cb512-14"><a href="#cb512-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb512-15"><a href="#cb512-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If by panel, put panels below in color and group.</span></span>
<span id="cb512-16"><a href="#cb512-16" aria-hidden="true" tabindex="-1"></a>  sqav_sp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> filtered_data,</span>
<span id="cb512-17"><a href="#cb512-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> al_regs,</span>
<span id="cb512-18"><a href="#cb512-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> sqav_profit,</span>
<span id="cb512-19"><a href="#cb512-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> <span class="fu">factor</span>(panels),</span>
<span id="cb512-20"><a href="#cb512-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">group =</span> <span class="fu">factor</span>(panels))) <span class="sc">+</span></span>
<span id="cb512-21"><a href="#cb512-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb512-22"><a href="#cb512-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb512-23"><a href="#cb512-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(height <span class="sc">~</span> array,</span>
<span id="cb512-24"><a href="#cb512-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb512-25"><a href="#cb512-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(</span>
<span id="cb512-26"><a href="#cb512-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4.6"</span> <span class="ot">=</span> <span class="st">"4.6 ft. Height"</span>,</span>
<span id="cb512-27"><a href="#cb512-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6.4"</span> <span class="ot">=</span> <span class="st">"6.4 ft. Height"</span>,</span>
<span id="cb512-28"><a href="#cb512-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8.2"</span> <span class="ot">=</span> <span class="st">"8.2 ft. Height"</span>,</span>
<span id="cb512-29"><a href="#cb512-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tracking =</span> <span class="st">"Single Axis Rotation"</span>, </span>
<span id="cb512-30"><a href="#cb512-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Fixed =</span> <span class="st">"Fixed Open Rack"</span></span>
<span id="cb512-31"><a href="#cb512-31" aria-hidden="true" tabindex="-1"></a>                   ))) <span class="sc">+</span></span>
<span id="cb512-32"><a href="#cb512-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb512-33"><a href="#cb512-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb512-34"><a href="#cb512-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>,</span>
<span id="cb512-35"><a href="#cb512-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>), </span>
<span id="cb512-36"><a href="#cb512-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"Center"</span>, </span>
<span id="cb512-37"><a href="#cb512-37" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"B Belt"</span>, <span class="st">"South"</span>)) <span class="sc">+</span></span>
<span id="cb512-38"><a href="#cb512-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb512-39"><a href="#cb512-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb512-40"><a href="#cb512-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Regions of Alabama"</span>,</span>
<span id="cb512-41"><a href="#cb512-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Profit ($) from Squash Agrivoltaic System"</span>,</span>
<span id="cb512-42"><a href="#cb512-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Number of Solar </span><span class="sc">\n</span><span class="st"> Panels per Acre"</span>,</span>
<span id="cb512-43"><a href="#cb512-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> (<span class="fu">list</span>(combinations[combo,]))</span>
<span id="cb512-44"><a href="#cb512-44" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb512-45"><a href="#cb512-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb512-46"><a href="#cb512-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add horizontal line at y = 0 if y has both positive and negative values</span></span>
<span id="cb512-47"><a href="#cb512-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(filtered_data<span class="sc">$</span>sqav_profit) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb512-48"><a href="#cb512-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(filtered_data<span class="sc">$</span>sqav_profit) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb512-49"><a href="#cb512-49" aria-hidden="true" tabindex="-1"></a>    sqav_sp_plot <span class="ot">&lt;-</span> sqav_sp_plot <span class="sc">+</span> </span>
<span id="cb512-50"><a href="#cb512-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb512-51"><a href="#cb512-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.30</span>, </span>
<span id="cb512-52"><a href="#cb512-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb512-53"><a href="#cb512-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb512-54"><a href="#cb512-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb512-55"><a href="#cb512-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combinations[combo,])</span>
<span id="cb512-56"><a href="#cb512-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sqav_sp_plot)</span>
<span id="cb512-57"><a href="#cb512-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/sqav_sp_"</span>, combo, <span class="st">".png"</span>))</span>
<span id="cb512-58"><a href="#cb512-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#break</span></span>
<span id="cb512-59"><a href="#cb512-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
1    0.1    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
2    0.3    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
3    0.5    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
4    0.7    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
5      1    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
6    1.2    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
7    1.5    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
8    1.8    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  yldvar price elcprc
9      2    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
10    0.1    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
11    0.3    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
12    0.5    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
13    0.7    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
14      1    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
15    1.2    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
16    1.5    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
17    1.8    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
18      2    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
19    0.1    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
20    0.3    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
21    0.5    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
22    0.7    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
23      1    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
24    1.2    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
25    1.5    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
26    1.8    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
27      2    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
28    0.1    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
29    0.3    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
30    0.5    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
31    0.7    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
32      1    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
33    1.2    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
34    1.5    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
35    1.8    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
36      2    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
37    0.1    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
38    0.3    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
39    0.5    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
40    0.7    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
41      1    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
42    1.2    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
43    1.5    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
44    1.8    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
45      2    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-45.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
46    0.1    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-46.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
47    0.3    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-47.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
48    0.5    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-48.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
49    0.7    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-49.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
50      1    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-50.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
51    1.2    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-51.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
52    1.5    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-52.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
53    1.8    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-53.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
54      2    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-54.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
55    0.1    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-55.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
56    0.3    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-56.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
57    0.5    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-57.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
58    0.7    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-58.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
59      1    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-59.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
60    1.2    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-60.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
61    1.5    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-61.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
62    1.8    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-62.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
63      2    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-63.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
64    0.1    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-64.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
65    0.3    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-65.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
66    0.5    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-66.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
67    0.7    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-67.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
68      1    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-68.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
69    1.2    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-69.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
70    1.5    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-70.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
71    1.8    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-71.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
72      2    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-72.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
73    0.1    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-73.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
74    0.3    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-74.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
75    0.5    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-75.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
76    0.7    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-76.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
77      1    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-77.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
78    1.2    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-78.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
79    1.5    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-79.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
80    1.8    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-80.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   yldvar price elcprc
81      2    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-58-81.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-squash-profit-by-yields" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="plotting-squash-profit-by-yields"><span class="header-section-number">5.9</span> Plotting Squash Profit by Yields</h2>
<p>You can see plot breakdown based on solar proportion, crop price, and electricity price. You can see variation for all crop yield variation in one facet of the chart. Each facet of the chart contain av profit three heights of solar panels, four regions of AL, two array types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb675"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1" aria-hidden="true" tabindex="-1"></a>combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb675-2"><a href="#cb675-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sprop =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">1.00</span>), <span class="co"># Solar proportion</span></span>
<span id="cb675-3"><a href="#cb675-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">17</span>), <span class="co"># Squash price</span></span>
<span id="cb675-4"><a href="#cb675-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">elcprc =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>) <span class="co">#Electricity price</span></span>
<span id="cb675-5"><a href="#cb675-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb675-6"><a href="#cb675-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb675-7"><a href="#cb675-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the combinations and create the plots</span></span>
<span id="cb675-8"><a href="#cb675-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (combo <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(combinations))) {</span>
<span id="cb675-9"><a href="#cb675-9" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> sqav_profit <span class="sc">%&gt;%</span></span>
<span id="cb675-10"><a href="#cb675-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb675-11"><a href="#cb675-11" aria-hidden="true" tabindex="-1"></a>      sprop <span class="sc">==</span> combinations<span class="sc">$</span>sprop[combo],</span>
<span id="cb675-12"><a href="#cb675-12" aria-hidden="true" tabindex="-1"></a>      price <span class="sc">==</span> combinations<span class="sc">$</span>price[combo],</span>
<span id="cb675-13"><a href="#cb675-13" aria-hidden="true" tabindex="-1"></a>      elcprc <span class="sc">==</span> combinations<span class="sc">$</span>elcprc[combo]</span>
<span id="cb675-14"><a href="#cb675-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb675-15"><a href="#cb675-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If by yield, put yield below in color and group.</span></span>
<span id="cb675-16"><a href="#cb675-16" aria-hidden="true" tabindex="-1"></a>  sqav_yv_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> filtered_data,</span>
<span id="cb675-17"><a href="#cb675-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> al_regs,</span>
<span id="cb675-18"><a href="#cb675-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> sqav_profit,</span>
<span id="cb675-19"><a href="#cb675-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> <span class="fu">factor</span>(yield),</span>
<span id="cb675-20"><a href="#cb675-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">group =</span> <span class="fu">factor</span>(yield))) <span class="sc">+</span></span>
<span id="cb675-21"><a href="#cb675-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb675-22"><a href="#cb675-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb675-23"><a href="#cb675-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(height <span class="sc">~</span> array,</span>
<span id="cb675-24"><a href="#cb675-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb675-25"><a href="#cb675-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(</span>
<span id="cb675-26"><a href="#cb675-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"4.6"</span> <span class="ot">=</span> <span class="st">"4.6 ft. Height"</span>,</span>
<span id="cb675-27"><a href="#cb675-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"6.4"</span> <span class="ot">=</span> <span class="st">"6.4 ft. Height"</span>,</span>
<span id="cb675-28"><a href="#cb675-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"8.2"</span> <span class="ot">=</span> <span class="st">"8.2 ft. Height"</span>,</span>
<span id="cb675-29"><a href="#cb675-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tracking =</span> <span class="st">"Single Axis Rotation"</span>, </span>
<span id="cb675-30"><a href="#cb675-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Fixed =</span> <span class="st">"Fixed Open Rack"</span></span>
<span id="cb675-31"><a href="#cb675-31" aria-hidden="true" tabindex="-1"></a>                   ))) <span class="sc">+</span></span>
<span id="cb675-32"><a href="#cb675-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb675-33"><a href="#cb675-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb675-34"><a href="#cb675-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Northern"</span>, <span class="st">"Central"</span>,</span>
<span id="cb675-35"><a href="#cb675-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Black Belt"</span>, <span class="st">"Southern"</span>), </span>
<span id="cb675-36"><a href="#cb675-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"Center"</span>, </span>
<span id="cb675-37"><a href="#cb675-37" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"B Belt"</span>, <span class="st">"South"</span>)) <span class="sc">+</span></span>
<span id="cb675-38"><a href="#cb675-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb675-39"><a href="#cb675-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb675-40"><a href="#cb675-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Regions of Alabama"</span>,</span>
<span id="cb675-41"><a href="#cb675-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Profit ($) from Squash Agrivoltaic System"</span>,</span>
<span id="cb675-42"><a href="#cb675-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Squash Yield </span><span class="sc">\n</span><span class="st"> (25 Lb Buckets)"</span>,</span>
<span id="cb675-43"><a href="#cb675-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> (<span class="fu">list</span>(combinations[combo,]))</span>
<span id="cb675-44"><a href="#cb675-44" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb675-45"><a href="#cb675-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb675-46"><a href="#cb675-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add horizontal line at y = 0 if y has both positive and negative values</span></span>
<span id="cb675-47"><a href="#cb675-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(filtered_data<span class="sc">$</span>sqav_profit) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb675-48"><a href="#cb675-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(filtered_data<span class="sc">$</span>sqav_profit) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb675-49"><a href="#cb675-49" aria-hidden="true" tabindex="-1"></a>    sqav_yv_plot <span class="ot">&lt;-</span> sqav_yv_plot <span class="sc">+</span> </span>
<span id="cb675-50"><a href="#cb675-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, </span>
<span id="cb675-51"><a href="#cb675-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.30</span>, </span>
<span id="cb675-52"><a href="#cb675-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb675-53"><a href="#cb675-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb675-54"><a href="#cb675-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb675-55"><a href="#cb675-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(combinations[combo,])</span>
<span id="cb675-56"><a href="#cb675-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sqav_yv_plot)</span>
<span id="cb675-57"><a href="#cb675-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"Plots/sqav_yv_"</span>, combo, <span class="st">".png"</span>))</span>
<span id="cb675-58"><a href="#cb675-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#break</span></span>
<span id="cb675-59"><a href="#cb675-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
1     0    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
2  0.25    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
3   0.5    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
4  0.75    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
5     1    11   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
6     0    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
7  0.25    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
8   0.5    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  sprop price elcprc
9  0.75    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
10     1    14   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
11     0    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
12  0.25    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
13   0.5    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
14  0.75    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
15     1    17   0.03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
16     0    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
17  0.25    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
18   0.5    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
19  0.75    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
20     1    11   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
21     0    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
22  0.25    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
23   0.5    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
24  0.75    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
25     1    14   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
26     0    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
27  0.25    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
28   0.5    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
29  0.75    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
30     1    17   0.04</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
31     0    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
32  0.25    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
33   0.5    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
34  0.75    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
35     1    11   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
36     0    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
37  0.25    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
38   0.5    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
39  0.75    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
40     1    14   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
41     0    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
42  0.25    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
43   0.5    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
44  0.75    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   sprop price elcprc
45     1    17   0.05</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AV-Profit_files/figure-html/unnamed-chunk-59-45.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>